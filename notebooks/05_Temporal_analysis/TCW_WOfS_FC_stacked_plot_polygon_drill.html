


<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Water, wet vegetation and fractional cover polygon drill stack plot &mdash; Digital Earth Australia 1.0.0 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../../_static/dea-favicon.ico"/>
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="https://unpkg.com/font-awesome@4.5.0/css/font-awesome.min.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/custom.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Hovmoller of Tasselled Cap Wetness, Brightness, Greenness, Rainfall" href="Hovmoller_TCI_and_Rainfall.html" />
    <link rel="prev" title="Interrogate crop poylgon to explore phenology" href="InterrogateCropPolygonForPhenology.html" /> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html">
          

          
            
            <img src="../../_static/dea-logo-inline.svg" class="logo" alt="Logo"/>
          
          </a>

          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Overview</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../about/intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../about/glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../about/changelog.html">DEA NCI Environment Changelog</a></li>
</ul>
<p class="caption"><span class="caption-text">Connect</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../connect/account.html">NCI Account Registration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../connect/install.html">Installation and Software Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../connect/get_help.html">Getting help</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../connect/nci_basics.html">Command Line Usage (Advanced)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../connect/jupyter.html">Jupyter Notebooks Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../internal/other_modules.html">Other Modules</a></li>
</ul>
<p class="caption"><span class="caption-text">User Guide</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../01_Getting_started/README.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../02_DEA_datasets/README.html">DEA Datasets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../03_Integrating_external_data/README.html">Integrating External Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../04_Index_calculation/README.html">Index Calculation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="README.html">Temporal Analyses</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="Interactive_phenology_plot_tagged.html">Visualising vegetation phenology</a></li>
<li class="toctree-l2"><a class="reference internal" href="LoadingCloudfreeSentinel2andLandsat.html">Loading cloud-free Sentinel 2 and Landsat from multiple satellites into one dataset</a></li>
<li class="toctree-l2"><a class="reference internal" href="PolygonDrill.html">Polygon drill</a></li>
<li class="toctree-l2"><a class="reference internal" href="PixelDrillWithWidgets.html">Pixel drill using interactive widgets</a></li>
<li class="toctree-l2"><a class="reference internal" href="PerPixelRegression.html">Per-pixel regression of tide heights vs. MNDWI</a></li>
<li class="toctree-l2"><a class="reference internal" href="InterrogateCropPolygonForPhenology.html">Interrogate crop poylgon to explore phenology</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Water, wet vegetation and fractional cover polygon drill stack plot</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#import-modules">import modules</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Set-up-polygon">Set up polygon</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Set-up-query">Set up query</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Set-up-datasets">Set up datasets</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#set-cloudmasking-threshold-and-load-landsat-nbart-data">set cloudmasking threshold and load landsat nbart data</a></li>
<li class="toctree-l3"><a class="reference internal" href="#mask-the-data-with-our-original-polygon-to-remove-extra-data">mask the data with our original polygon to remove extra data</a></li>
<li class="toctree-l3"><a class="reference internal" href="#create-a-masked-version-of-the-extent-of-overthreshold-wetness">create a masked version of the extent of overthreshold wetness</a></li>
<li class="toctree-l3"><a class="reference internal" href="#load-wofls-and-select-only-wet-pixels">load wofls and select only wet pixels</a></li>
<li class="toctree-l3"><a class="reference internal" href="#mask-the-wofs-obs">mask the wofs obs</a></li>
<li class="toctree-l3"><a class="reference internal" href="#load-in-fractional-cover-data">load in fractional cover data</a></li>
<li class="toctree-l3"><a class="reference internal" href="#mask-FC-with-polygon">mask FC with polygon</a></li>
<li class="toctree-l3"><a class="reference internal" href="#mask-FC-with-wetness">mask FC with wetness</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Calculate-number-of-pixels-in-area-of-interest">Calculate number of pixels in area of interest</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Calculate-the-dominant-fraction-for-each-pixel-in-Fractional-Cover">Calculate the dominant fraction for each pixel in Fractional Cover</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="Hovmoller_TCI_and_Rainfall.html">Hovmoller of Tasselled Cap Wetness, Brightness, Greenness, Rainfall</a></li>
<li class="toctree-l2"><a class="reference internal" href="Hovmoller_NDVI.html">Hovmoller plot of NDVI and Rainfall</a></li>
<li class="toctree-l2"><a class="reference internal" href="Hovmoller_TCI_Multi-site.html">Hovmoller of Tasselled Cap Wetness, Brightness, Greenness, Rainfall for Multiple Sites</a></li>
<li class="toctree-l2"><a class="reference internal" href="Hovmoller_NDVI_Multi-site.html">Hovmoller plots of NDVI and Rainfall (multiple sites)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../06_Composite_generation/README.html">Composite Generation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../07_Image_classification/README.html">Image Classification</a></li>
<li class="toctree-l1"><a class="reference internal" href="../08_Outputting_data/README.html">Outputting data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../09_Workflows/README.html">Workflows</a></li>
<li class="toctree-l1"><a class="reference internal" href="../10_Scripts/README.html">Scripts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Supplementary_data/README.html">Supplementary Data</a></li>
</ul>
<p class="caption"><span class="caption-text">Data Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../data/data.html">Surface Reflectance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../data/s3.html">Products Available on Amazon S3</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../data/s3-sftp.html">Bulk download products from Amazon S3</a></li>
</ul>
<p class="caption"><span class="caption-text">Developer Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../internal/new_product.html">Creating a New Product</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../internal/git_best_practice.html">Git Best Practice</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../internal/release.html">DEA Release Process</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../internal/modules.html">DEA Modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../internal/collection_management.html">Collection Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../internal/requirements_met.html">DEA Code Functionality Examples</a></li>
</ul>
<p class="caption"><span class="caption-text">Indexes</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../genindex.html">Tags Index</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Digital Earth Australia</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="README.html">Temporal Analyses</a> &raquo;</li>
        
      <li>Water, wet vegetation and fractional cover polygon drill stack plot</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/notebooks/05_Temporal_analysis/TCW_WOfS_FC_stacked_plot_polygon_drill.ipynb.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput,
div.nbinput div.prompt,
div.nbinput div.input_area,
div.nbinput div[class*=highlight],
div.nbinput div[class*=highlight] pre,
div.nboutput,
div.nbinput div.prompt,
div.nbinput div.output_area,
div.nboutput div[class*=highlight],
div.nboutput div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput,
div.nboutput {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput,
    div.nboutput {
        flex-direction: column;
    }
}

/* input container */
div.nbinput {
    padding-top: 5px;
}

/* last container */
div.nblast {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput div.prompt,
div.nboutput div.prompt {
    min-width: 5ex;
    padding-top: 0.4em;
    padding-right: 0.4em;
    text-align: right;
    flex: 0;
}
@media (max-width: 540px) {
    div.nbinput div.prompt,
    div.nboutput div.prompt {
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput div.prompt.empty {
        padding: 0;
    }
}

/* disable scrollbars on prompts */
div.nbinput div.prompt pre,
div.nboutput div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput div.input_area,
div.nboutput div.output_area {
    padding: 0.4em;
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput div.input_area,
    div.nboutput div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    background: #f5f5f5;
}

/* override MathJax center alignment in output cells */
div.nboutput div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput div.math p {
    text-align: left;
}

/* standard error */
div.nboutput div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast,
.nboutput.nblast {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast + .nbinput {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="Water,-wet-vegetation-and-fractional-cover-polygon-drill-stack-plot">
<h1>Water, wet vegetation and fractional cover polygon drill stack plot<a class="headerlink" href="#Water,-wet-vegetation-and-fractional-cover-polygon-drill-stack-plot" title="Permalink to this headline">¶</a></h1>
<table border="1" class="docutils">
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Authors:</th>
<th class="head">Bex Dunn</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Created:</td>
<td>Jan 7, 2019</td>
</tr>
<tr class="row-odd"><td>Last edited:</td>
<td>Jan 10, 2019</td>
</tr>
</tbody>
</table>
<p><strong>Requirements:</strong></p>
<p>You need to run the following commands from the command line prior to launching jupyter notebooks from the same terminal so that the required libraries and paths are set:</p>
<p><code class="docutils literal notranslate"><span class="pre">module</span> <span class="pre">use</span> <span class="pre">/g/data/v10/public/modules/modulefiles</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">module</span> <span class="pre">load</span> <span class="pre">dea</span></code></p>
<p>If you find an error or bug in this notebook, please either create an ‘Issue’ in the Github repository, or fix it yourself and create a ‘Pull’ request to contribute the updated notebook back into the repository (See the repository <a class="reference external" href="https://github.com/GeoscienceAustralia/dea-notebooks/blob/master/README.rst">README</a> for instructions on creating a Pull request).</p>
<p><strong>Background:</strong> Data from the <a class="reference external" href="https://landsat.usgs.gov/about-landsat">Landsat</a> 5,7 and 8 satellite missions are accessible through <a class="reference external" href="http://www.ga.gov.au/about/projects/geographic/digital-earth-australia">Digital Earth Australia</a> (DEA). The code snippets in this notebook will let you retrieve and plot the <a class="reference external" href="https://d28rz98at9flks.cloudfront.net/79676/Fractional_Cover_FC25_v1_5.PDF">Fractional Cover</a> (FC25) data stored in DEA.</p>
<p><strong>What does this notebook do?:</strong> This notebook takes a supplied shapefile of a polygon and queries the datacube for WOfS, Fractional Cover and NBART. It calculates thresholded tasselled cap wetness. The results are plotted against each other as a stacked plot for assessing change in wetlands or land cover.</p>
<p><strong>How to use this notebook:</strong></p>
<p>A basic understanding of any programming language is desirable but one doesn’t have to be an expert Python programmer to manipulate the code to get and display the data.This doc applies to the following Landsat satellites, Fractional Cover bands and the WOfS dataset:</p>
<ul class="simple">
<li>Landsat 5</li>
<li>Landsat 7</li>
<li>Landsat 8</li>
<li>PV - Photosythetic vegetation</li>
<li>NPV - Non-Photosythetic vegetation</li>
<li>BS - Bare Soil</li>
<li>WOfS Feature Layers (WOFLs)</li>
</ul>
<p><strong>Future Work:</strong> - do this by max extent of wetness - add rainfall for context</p>
<p><strong>Tags</strong>: <span class="target" id="index-0"></span>plot,:index:<cite>gridspec</cite>, <span class="target" id="index-1"></span>Landsat,:index:<cite>Landsat5</cite>,:index:<cite>Landsat7</cite>,:index:<cite>Landsat8</cite>, <span class="target" id="index-2"></span>polygondrill, <span class="target" id="index-3"></span>DEAPlotting, <span class="target" id="index-4"></span>shapefile, <span class="target" id="index-5"></span>geopolygon, <span class="target" id="index-6"></span>datacube.utils.geometry, <span class="target" id="index-7"></span>fiona, <span class="target" id="index-8"></span>rasterio, <span class="target" id="index-9"></span>query,:index:<cite>Scripts</cite>,:index:<cite>tasseled_cap</cite>,                                                                                                           <span class="target" id="index-10"></span>Fractional Cover, <span class="target" id="index-11"></span>DEADataHandling, <span class="target" id="index-12"></span>DEAPlotting, <span class="target" id="index-13"></span>stackplot,:index:<cite>masking</cite>,:index:<cite>make mask</cite>,:index:<cite>load_clearlandsat</cite></p>
<div class="section" id="import-modules">
<h2>import modules<a class="headerlink" href="#import-modules" title="Permalink to this headline">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">datacube</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">fiona</span>
<span class="kn">import</span> <span class="nn">geopandas</span> <span class="k">as</span> <span class="nn">gpd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">rasterio.mask</span>
<span class="kn">import</span> <span class="nn">rasterio.features</span>
<span class="kn">from</span> <span class="nn">shapely</span> <span class="k">import</span> <span class="n">geometry</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">xarray</span> <span class="k">as</span> <span class="nn">xr</span>

<span class="kn">import</span> <span class="nn">matplotlib.dates</span> <span class="k">as</span> <span class="nn">mdates</span>
<span class="kn">import</span> <span class="nn">matplotlib.gridspec</span> <span class="k">as</span> <span class="nn">gridspec</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="kn">from</span> <span class="nn">datacube.storage</span> <span class="k">import</span> <span class="n">masking</span>
<span class="kn">from</span> <span class="nn">datacube.utils</span> <span class="k">import</span> <span class="n">geometry</span>

<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;../10_Scripts&#39;</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">DEADataHandling</span><span class="o">,</span> <span class="nn">DEAPlotting</span><span class="o">,</span> <span class="nn">TasseledCapTools</span>

<span class="n">dc</span> <span class="o">=</span> <span class="n">datacube</span><span class="o">.</span><span class="n">Datacube</span><span class="p">(</span><span class="n">app</span><span class="o">=</span><span class="s1">&#39;tci and wofs&#39;</span><span class="p">)</span>

<span class="o">%</span><span class="k">load_ext</span> autoreload

<span class="o">%</span><span class="k">autoreload</span> 2
</pre></div>
</div>
</div>
</div>
<div class="section" id="Set-up-polygon">
<h2>Set up polygon<a class="headerlink" href="#Set-up-polygon" title="Permalink to this headline">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">#change the path here if you want a different polygon</span>
<span class="c1">#poly_path = &#39;/g/data/r78/rjd547/groundwater_activities/Burdekin/Burdekin_shapefiles/reeves_lake_for_demo.shp&#39;</span>
<span class="n">poly_path</span> <span class="o">=</span> <span class="s1">&#39;/g/data/r78/SA_mound_springs/Big_Blythe_small.shp&#39;</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">#open the polygon</span>
<span class="k">with</span> <span class="n">fiona</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">poly_path</span><span class="p">)</span> <span class="k">as</span> <span class="n">shapes</span><span class="p">:</span>
        <span class="n">crs</span> <span class="o">=</span> <span class="n">geometry</span><span class="o">.</span><span class="n">CRS</span><span class="p">(</span><span class="n">shapes</span><span class="o">.</span><span class="n">crs_wkt</span><span class="p">)</span>
        <span class="n">first_geometry</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">shapes</span><span class="p">))[</span><span class="s1">&#39;geometry&#39;</span><span class="p">]</span>
        <span class="n">geom</span> <span class="o">=</span> <span class="n">geometry</span><span class="o">.</span><span class="n">Geometry</span><span class="p">(</span><span class="n">first_geometry</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="n">crs</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">#plot polygon to check it looks ok</span>
<span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
<span class="n">shape_plot</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">poly_path</span><span class="p">)</span>
<span class="n">shape_plot</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>&lt;Figure size 432x288 with 0 Axes&gt;
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/notebooks_05_Temporal_analysis_TCW_WOfS_FC_stacked_plot_polygon_drill_9_1.png" src="../../_images/notebooks_05_Temporal_analysis_TCW_WOfS_FC_stacked_plot_polygon_drill_9_1.png" />
</div>
</div>
</div>
<div class="section" id="Set-up-query">
<h2>Set up query<a class="headerlink" href="#Set-up-query" title="Permalink to this headline">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">query</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;geopolygon&#39;</span><span class="p">:</span> <span class="n">geom</span><span class="p">,</span>
         <span class="c1">#&#39;time&#39;: (&#39;2016-01-01&#39;, &#39;2018-06-30&#39;)</span>
         <span class="c1">#&#39;time&#39;: (&#39;2007-01-01&#39;, &#39;2007-06-30&#39;)</span>
         <span class="s1">&#39;time&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;1987-01-01&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-01-01&#39;</span><span class="p">)</span>
         <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="Set-up-datasets">
<h3>Set up datasets<a class="headerlink" href="#Set-up-datasets" title="Permalink to this headline">¶</a></h3>
</div>
</div>
<div class="section" id="set-cloudmasking-threshold-and-load-landsat-nbart-data">
<h2>set cloudmasking threshold and load landsat nbart data<a class="headerlink" href="#set-cloudmasking-threshold-and-load-landsat-nbart-data" title="Permalink to this headline">¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">#set cloudmasking threshold and load landsat nbart data</span>
<span class="n">landsat_masked_prop</span> <span class="o">=</span> <span class="mf">0.90</span>
<span class="n">ls578_ds</span> <span class="o">=</span> <span class="n">DEADataHandling</span><span class="o">.</span><span class="n">load_clearlandsat</span><span class="p">(</span><span class="n">dc</span><span class="o">=</span><span class="n">dc</span><span class="p">,</span> <span class="n">query</span><span class="o">=</span><span class="n">query</span><span class="p">,</span> <span class="n">product</span><span class="o">=</span><span class="s1">&#39;nbart&#39;</span><span class="p">,</span>
        <span class="n">masked_prop</span><span class="o">=</span><span class="n">landsat_masked_prop</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Loading ls5 pixel quality
    Loading 278 filtered ls5 timesteps
Ignoring SLC-off observations for ls7
Loading ls7 pixel quality
    Loading 65 filtered ls7 timesteps
Loading ls8 pixel quality
    Loading 96 filtered ls8 timesteps
Combining and sorting ls5, ls7, ls8 data
    Replacing invalid -999 values with NaN (data will be coerced to float64)
</pre></div></div>
</div>
</div>
<div class="section" id="mask-the-data-with-our-original-polygon-to-remove-extra-data">
<h2>mask the data with our original polygon to remove extra data<a class="headerlink" href="#mask-the-data-with-our-original-polygon-to-remove-extra-data" title="Permalink to this headline">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">data</span> <span class="o">=</span> <span class="n">ls578_ds</span>
<span class="n">mask</span> <span class="o">=</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">features</span><span class="o">.</span><span class="n">geometry_mask</span><span class="p">([</span><span class="n">geom</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">geobox</span><span class="o">.</span><span class="n">crs</span><span class="p">)</span><span class="k">for</span> <span class="n">geoms</span> <span class="ow">in</span> <span class="p">[</span><span class="n">geom</span><span class="p">]],</span>
                                           <span class="n">out_shape</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">geobox</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
                                           <span class="n">transform</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">geobox</span><span class="o">.</span><span class="n">affine</span><span class="p">,</span>
                                           <span class="n">all_touched</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                           <span class="n">invert</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">#for some reason xarray is not playing nicely with our old masking function</span>
<span class="n">mask_xr</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">dims</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">,</span><span class="s1">&#39;x&#39;</span><span class="p">))</span>
<span class="n">ls578_ds</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask_xr</span><span class="o">==</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">#transform the nbart into tci</span>
<span class="n">tci</span> <span class="o">=</span> <span class="n">TasseledCapTools</span><span class="o">.</span><span class="n">thresholded_tasseled_cap</span><span class="p">(</span><span class="n">ls578_ds</span><span class="p">,</span><span class="n">wetness_threshold</span><span class="o">=-</span><span class="mi">350</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">True</span> <span class="p">,</span> <span class="n">drop_tc_bands</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="create-a-masked-version-of-the-extent-of-overthreshold-wetness">
<h2>create a masked version of the extent of overthreshold wetness<a class="headerlink" href="#create-a-masked-version-of-the-extent-of-overthreshold-wetness" title="Permalink to this headline">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">#select only finite values (over threshold values)</span>
<span class="n">tcw</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">ufuncs</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">tci</span><span class="o">.</span><span class="n">wetness_thresholded</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># #reapply the polygon mask</span>
<span class="n">tcw</span> <span class="o">=</span> <span class="n">tcw</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask_xr</span><span class="o">==</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="load-wofls-and-select-only-wet-pixels">
<h2>load wofls and select only wet pixels<a class="headerlink" href="#load-wofls-and-select-only-wet-pixels" title="Permalink to this headline">¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">#load wofs</span>
<span class="n">wofls</span> <span class="o">=</span> <span class="n">dc</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">product</span> <span class="o">=</span> <span class="s1">&#39;wofs_albers&#39;</span><span class="p">,</span> <span class="n">like</span><span class="o">=</span><span class="n">ls578_ds</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/g/data/v10/public/modules/dea/20181015/lib/python3.6/site-packages/datacube/api/query.py:93: FutureWarning: casting an xarray.Dataset to a boolean will change in xarray v0.11 to only include data variables, not coordinates. Cast the Dataset.variables property instead to preserve existing behavior in a forwards compatible manner.
  if like:
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">#only get wet obs</span>
<span class="n">wetwofl</span> <span class="o">=</span> <span class="n">masking</span><span class="o">.</span><span class="n">make_mask</span><span class="p">(</span><span class="n">wofls</span><span class="p">,</span> <span class="n">wet</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">#match the wofs observations to the nbart</span>
<span class="n">wetwofl</span><span class="o">=</span><span class="n">wetwofl</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">wofls</span><span class="o">.</span><span class="n">time</span><span class="o">==</span><span class="n">ls578_ds</span><span class="o">.</span><span class="n">time</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="mask-the-wofs-obs">
<h2>mask the wofs obs<a class="headerlink" href="#mask-the-wofs-obs" title="Permalink to this headline">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">#mask the wofs obs with the polygon mask</span>
<span class="n">wetwofl</span> <span class="o">=</span> <span class="n">wetwofl</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask_xr</span><span class="o">==</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="load-in-fractional-cover-data">
<h2>load in fractional cover data<a class="headerlink" href="#load-in-fractional-cover-data" title="Permalink to this headline">¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">#load the data according to our query</span>
<span class="c1">#choose a mask proportion to look for a clear timestep</span>
<span class="n">fc_ds</span> <span class="o">=</span> <span class="n">DEADataHandling</span><span class="o">.</span><span class="n">load_clearlandsat</span><span class="p">(</span><span class="n">dc</span><span class="p">,</span> <span class="n">query</span><span class="p">,</span><span class="n">product</span><span class="o">=</span><span class="s1">&#39;fc&#39;</span><span class="p">,</span><span class="n">masked_prop</span><span class="o">=</span><span class="mf">0.90</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Loading ls5 pixel quality
    Loading 278 filtered ls5 timesteps
Ignoring SLC-off observations for ls7
Loading ls7 pixel quality
    Loading 65 filtered ls7 timesteps
Loading ls8 pixel quality
    Loading 96 filtered ls8 timesteps
Combining and sorting ls5, ls7, ls8 data
    Replacing invalid -999 values with NaN (data will be coerced to float64)
</pre></div></div>
</div>
</div>
<div class="section" id="mask-FC-with-polygon">
<h2>mask FC with polygon<a class="headerlink" href="#mask-FC-with-polygon" title="Permalink to this headline">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fc_ds</span> <span class="o">=</span> <span class="n">fc_ds</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask_xr</span><span class="o">==</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="mask-FC-with-wetness">
<h2>mask FC with wetness<a class="headerlink" href="#mask-FC-with-wetness" title="Permalink to this headline">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fc_ds_noTCW</span><span class="o">=</span><span class="n">fc_ds</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">tcw</span><span class="o">==</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">#set scene to plot</span>
<span class="n">scene</span> <span class="o">=</span><span class="mi">2</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">#set up our images on a grid using gridspec</span>
<span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
<span class="n">gs</span> <span class="o">=</span> <span class="n">gridspec</span><span class="o">.</span><span class="n">GridSpec</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="c1"># set up a 2 x 2 grid of 4 images for better presentation</span>

<span class="n">ax1</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
<span class="n">fc_ds_noTCW</span><span class="o">.</span><span class="n">PV</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">scene</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gist_earth_r&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;PV&#39;</span><span class="p">)</span>

<span class="n">ax2</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
<span class="n">fc_ds_noTCW</span><span class="o">.</span><span class="n">BS</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">scene</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Oranges&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;BS&#39;</span><span class="p">)</span>

<span class="n">ax3</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
<span class="n">fc_ds_noTCW</span><span class="o">.</span><span class="n">NPV</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">scene</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;copper&#39;</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;NPV&#39;</span><span class="p">)</span>

<span class="n">ax4</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
<span class="n">fc_ds_noTCW</span><span class="o">.</span><span class="n">UE</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">scene</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;magma&#39;</span><span class="p">)</span>
<span class="n">ax4</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;UE&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>&lt;Figure size 432x288 with 0 Axes&gt;
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/notebooks_05_Temporal_analysis_TCW_WOfS_FC_stacked_plot_polygon_drill_35_1.png" src="../../_images/notebooks_05_Temporal_analysis_TCW_WOfS_FC_stacked_plot_polygon_drill_35_1.png" />
</div>
</div>
</div>
<div class="section" id="Calculate-number-of-pixels-in-area-of-interest">
<h2>Calculate number of pixels in area of interest<a class="headerlink" href="#Calculate-number-of-pixels-in-area-of-interest" title="Permalink to this headline">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">#number of pixels in area of interest</span>
<span class="n">pixels</span> <span class="o">=</span> <span class="p">(</span><span class="n">mask_xr</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="s1">&#39;y&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">mask_xr</span><span class="o">==</span><span class="mi">0</span>
<span class="n">mask_xr</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="s1">&#39;y&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>&lt;xarray.DataArray ()&gt;
array(4154)
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">#count number of wofs pixels</span>
<span class="n">wofs_pixels</span> <span class="o">=</span> <span class="n">wetwofl</span><span class="o">.</span><span class="n">water</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="s1">&#39;y&#39;</span><span class="p">])</span>

<span class="c1">#count percentage of area of wofs</span>
<span class="n">wofs_area_percent</span> <span class="o">=</span> <span class="p">(</span><span class="n">wofs_pixels</span><span class="o">/</span><span class="n">pixels</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span>

<span class="c1">#count number of tcw pixels</span>
<span class="n">tcw_pixel_count</span> <span class="o">=</span> <span class="n">tcw</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="s1">&#39;y&#39;</span><span class="p">])</span>

<span class="c1">#calculate percentage area wet</span>
<span class="n">tcw_area_percent</span> <span class="o">=</span> <span class="p">(</span><span class="n">tcw_pixel_count</span><span class="o">/</span><span class="n">pixels</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span>

<span class="c1">#calculate wet not wofs</span>
<span class="n">tcw_less_wofs</span> <span class="o">=</span> <span class="n">tcw_area_percent</span><span class="o">-</span><span class="n">wofs_area_percent</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Calculate-the-dominant-fraction-for-each-pixel-in-Fractional-Cover">
<h2>Calculate the dominant fraction for each pixel in Fractional Cover<a class="headerlink" href="#Calculate-the-dominant-fraction-for-each-pixel-in-Fractional-Cover" title="Permalink to this headline">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">#drop data percentage and Unmixing Error</span>
<span class="n">fc_tester</span> <span class="o">=</span> <span class="n">fc_ds_noTCW</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;data_perc&#39;</span><span class="p">,</span><span class="s1">&#39;UE&#39;</span><span class="p">])</span>

<span class="c1">#following robbi&#39;s advice, cast the dataset to a dataarray</span>
<span class="n">maxFC</span> <span class="o">=</span> <span class="n">fc_tester</span><span class="o">.</span><span class="n">to_array</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;variable&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;maxFC&#39;</span><span class="p">)</span>

<span class="c1">#turn FC array into integer only as nanargmax doesn&#39;t seem to handle floats the way we want it to</span>
<span class="n">FC_int</span> <span class="o">=</span> <span class="n">maxFC</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;int8&#39;</span><span class="p">)</span>

<span class="c1">#use numpy.nanargmax to get the index of the maximum value along the variable dimension</span>
<span class="c1">#BSPVNPV=np.nanargmax(FC_int, axis=0)</span>
<span class="n">BSPVNPV</span><span class="o">=</span><span class="n">FC_int</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;variable&#39;</span><span class="p">)</span>

<span class="n">FC_mask</span><span class="o">=</span><span class="n">xr</span><span class="o">.</span><span class="n">ufuncs</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">maxFC</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;variable&#39;</span><span class="p">)</span>

<span class="c1"># #re-mask with nans to remove no-data</span>
<span class="n">BSPVNPV</span><span class="o">=</span><span class="n">BSPVNPV</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">FC_mask</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">#plot the results to check they look roughly like what we are expecting</span>
<span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">BSPVNPV</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>&lt;matplotlib.colorbar.Colorbar at 0x7f236d1766a0&gt;
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/notebooks_05_Temporal_analysis_TCW_WOfS_FC_stacked_plot_polygon_drill_42_1.png" src="../../_images/notebooks_05_Temporal_analysis_TCW_WOfS_FC_stacked_plot_polygon_drill_42_1.png" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">FC_dominant</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">({</span>
    <span class="s1">&#39;BS&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">BSPVNPV</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">FC_mask</span><span class="p">),</span>
    <span class="s1">&#39;PV&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">BSPVNPV</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">FC_mask</span><span class="p">),</span>
    <span class="s1">&#39;NPV&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">BSPVNPV</span><span class="o">==</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">FC_mask</span><span class="p">),</span>
<span class="p">})</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">FC_count</span> <span class="o">=</span> <span class="n">FC_dominant</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="s1">&#39;y&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">#Fractional cover pixel count method</span>
<span class="c1">#Get number of FC pixels, divide by total number of pixels per polygon</span>

<span class="n">Bare_soil_percent</span><span class="o">=</span><span class="p">(</span><span class="n">FC_count</span><span class="o">.</span><span class="n">BS</span><span class="o">/</span><span class="n">pixels</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span>

<span class="n">Photosynthetic_veg_percent</span><span class="o">=</span><span class="p">(</span><span class="n">FC_count</span><span class="o">.</span><span class="n">PV</span><span class="o">/</span><span class="n">pixels</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span>

<span class="n">NonPhotosynthetic_veg_percent</span><span class="o">=</span><span class="p">(</span><span class="n">FC_count</span><span class="o">.</span><span class="n">NPV</span><span class="o">/</span><span class="n">pixels</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span>

<span class="n">NoData</span> <span class="o">=</span> <span class="mi">100</span> <span class="o">-</span> <span class="n">wofs_area_percent</span><span class="o">-</span> <span class="n">tcw_less_wofs</span> <span class="o">-</span> <span class="n">Photosynthetic_veg_percent</span> <span class="o">-</span> <span class="n">NonPhotosynthetic_veg_percent</span> <span class="o">-</span> <span class="n">Bare_soil_percent</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[46]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">query</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[46]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>&#39;1987-01-01&#39;
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[63]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">#set up color palette</span>
<span class="n">pal</span> <span class="o">=</span> <span class="p">[</span><span class="n">sns</span><span class="o">.</span><span class="n">xkcd_rgb</span><span class="p">[</span><span class="s2">&quot;cobalt blue&quot;</span><span class="p">],</span>
       <span class="n">sns</span><span class="o">.</span><span class="n">xkcd_rgb</span><span class="p">[</span><span class="s2">&quot;neon blue&quot;</span><span class="p">],</span>
       <span class="n">sns</span><span class="o">.</span><span class="n">xkcd_rgb</span><span class="p">[</span><span class="s2">&quot;grass&quot;</span><span class="p">],</span>
       <span class="n">sns</span><span class="o">.</span><span class="n">xkcd_rgb</span><span class="p">[</span><span class="s2">&quot;beige&quot;</span><span class="p">],</span>
       <span class="n">sns</span><span class="o">.</span><span class="n">xkcd_rgb</span><span class="p">[</span><span class="s2">&quot;brown&quot;</span><span class="p">]]</span><span class="c1">#,</span>
      <span class="c1">#sns.xkcd_rgb[&quot;grey&quot;]]</span>

<span class="c1">#make a stacked area plot</span>
<span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">stackplot</span><span class="p">(</span><span class="n">wofs_area_percent</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
              <span class="n">wofs_area_percent</span><span class="p">,</span>
              <span class="n">tcw_less_wofs</span><span class="p">,</span>
              <span class="n">Photosynthetic_veg_percent</span><span class="p">,</span>
              <span class="n">NonPhotosynthetic_veg_percent</span><span class="p">,</span>
              <span class="n">Bare_soil_percent</span><span class="p">,</span>
              <span class="n">NoData</span><span class="p">,</span>
              <span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;open water&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;wet&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;PV&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;NPV&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;BS&#39;</span><span class="c1">#,</span>
                      <span class="c1">#&#39;NoData&#39;</span>
                     <span class="p">],</span> <span class="n">colors</span><span class="o">=</span><span class="n">pal</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.6</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Percentage of area WOfS, Wetness, Fractional Cover&#39;</span><span class="p">)</span>

<span class="c1">#set axis limits to the min and max</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="n">xmin</span> <span class="o">=</span> <span class="n">query</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">xmax</span> <span class="o">=</span> <span class="n">query</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">ymin</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ymax</span> <span class="o">=</span> <span class="mi">100</span><span class="p">)</span>

<span class="c1">#set date ticks every year</span>
<span class="n">years</span> <span class="o">=</span> <span class="n">mdates</span><span class="o">.</span><span class="n">YearLocator</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">yearsFmt</span> <span class="o">=</span> <span class="n">mdates</span><span class="o">.</span><span class="n">DateFormatter</span><span class="p">(</span><span class="s1">&#39;%Y&#39;</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">years</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">yearsFmt</span><span class="p">)</span>

<span class="c1">#add a legend and a tight plot box</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

<span class="c1">#save the figure</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;/g/data/r78/rjd547/SA_mound_springs/Big_Blythe_small_all2.png&#39;</span><span class="p">)</span><span class="c1">#, transparent=True)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>&lt;Figure size 432x288 with 0 Axes&gt;
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/notebooks_05_Temporal_analysis_TCW_WOfS_FC_stacked_plot_polygon_drill_47_1.png" src="../../_images/notebooks_05_Temporal_analysis_TCW_WOfS_FC_stacked_plot_polygon_drill_47_1.png" />
</div>
</div>
<script type="application/vnd.jupyter.widget-state+json">
{"state": {}, "version_major": 2, "version_minor": 0}
</script></div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="Hovmoller_TCI_and_Rainfall.html" class="btn btn-neutral float-right" title="Hovmoller of Tasselled Cap Wetness, Brightness, Greenness, Rainfall" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="InterrogateCropPolygonForPhenology.html" class="btn btn-neutral" title="Interrogate crop poylgon to explore phenology" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017-2018, Geoscience Australia

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../_static/language_data.js"></script>
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script type="text/javascript" src="https://unpkg.com/@jupyter-widgets/html-manager@^0.14.0/dist/embed-amd.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    

  

  <script type="text/javascript" src="../../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>


<!-- Theme Analytics -->
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-113800428-1"></script>
<script>
 window.dataLayer = window.dataLayer || [];
 function gtag(){dataLayer.push(arguments);}
 gtag('js', new Date());
 
 gtag('config', 'UA-113800428-1');
</script>

    
  


</body>
</html>