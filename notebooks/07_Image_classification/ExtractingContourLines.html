


<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Extracting contour lines &mdash; Digital Earth Australia 1.0.0 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../../_static/dea-favicon.ico"/>
  
  
  
    <link rel="canonical" href="https://docs.dea.ga.gov.au/notebooks/07_Image_classification/ExtractingContourLines.html"/>
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../_static/language_data.js"></script>
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script type="text/javascript" src="https://unpkg.com/@jupyter-widgets/html-manager@^0.14.0/dist/embed-amd.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="https://unpkg.com/font-awesome@4.5.0/css/font-awesome.min.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/custom.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Find dams using WOFLs" href="FindDamsUsingWOFLs.html" />
    <link rel="prev" title="DEA WOfS and Water Classifier Notebook" href="DEA_WOfS_and_water_classifier.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html">
          

          
            
            <img src="../../_static/dea-logo-inline.svg" class="logo" alt="Logo"/>
          
          </a>

          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Overview</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../about/intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../about/glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../about/changelog.html">Changelog</a></li>
</ul>
<p class="caption"><span class="caption-text">Connect</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../connect/account.html">NCI Account Registration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../connect/install.html">Installation and Software Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../connect/get_help.html">Getting help</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../connect/nci_basics.html">Command Line Usage (Advanced)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../connect/jupyter.html">Jupyter Notebooks Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../internal/other_modules.html">Other Modules</a></li>
</ul>
<p class="caption"><span class="caption-text">User Guide</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../01_Getting_started/README.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../02_DEA_datasets/README.html">DEA Datasets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../03_Integrating_external_data/README.html">Integrating External Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../04_Index_calculation/README.html">Index Calculation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../05_Temporal_analysis/README.html">Temporal Analyses</a></li>
<li class="toctree-l1"><a class="reference internal" href="../06_Composite_generation/README.html">Composite Generation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="README.html">Image Classification</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="DEA_WOfS_and_water_classifier.html">DEA WOfS and Water Classifier Notebook</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Extracting contour lines</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Load-modules">Load modules</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Load-in-elevation-data">Load in elevation data</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Contour-extraction-in-'single-array,-multiple-z-values'-mode">Contour extraction in ‘single array, multiple z-values’ mode</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Extracting-a-single-contour">Extracting a single contour</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Extracting-multiple-contours">Extracting multiple contours</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Custom-shapefile-attributes">Custom shapefile attributes</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#Contours-from-non-elevation-datasets-in-in-'single-z-value,-multiple-arrays'-mode">Contours from non-elevation datasets in in ‘single z-value, multiple arrays’ mode</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Dropping-small-contours">Dropping small contours</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="FindDamsUsingWOFLs.html">Find dams using WOFLs</a></li>
<li class="toctree-l2"><a class="reference internal" href="RandomForestClassification.html">Random forest classification</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../08_Outputting_data/README.html">Outputting data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../09_Workflows/README.html">Workflows</a></li>
<li class="toctree-l1"><a class="reference internal" href="../10_Scripts/README.html">Scripts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Supplementary_data/README.html">Supplementary Data</a></li>
</ul>
<p class="caption"><span class="caption-text">Data Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../data/data.html">Surface Reflectance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../data/s3.html">Products Available on Amazon S3</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../data/s3-sftp.html">Bulk download products from Amazon S3</a></li>
</ul>
<p class="caption"><span class="caption-text">Developer Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../internal/new_product.html">Creating a New Product</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../internal/git_best_practice.html">Git Best Practice</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../internal/release.html">DEA Release Process</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../internal/modules.html">DEA Modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../internal/collection_management.html">Collection Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../internal/requirements_met.html">DEA Code Functionality Examples</a></li>
</ul>
<p class="caption"><span class="caption-text">Indexes</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../genindex.html">Tags Index</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Digital Earth Australia</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="README.html">Image Classification</a> &raquo;</li>
        
      <li>Extracting contour lines</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/notebooks/07_Image_classification/ExtractingContourLines.ipynb.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput,
div.nbinput div.prompt,
div.nbinput div.input_area,
div.nbinput div[class*=highlight],
div.nbinput div[class*=highlight] pre,
div.nboutput,
div.nbinput div.prompt,
div.nbinput div.output_area,
div.nboutput div[class*=highlight],
div.nboutput div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput,
div.nboutput {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput,
    div.nboutput {
        flex-direction: column;
    }
}

/* input container */
div.nbinput {
    padding-top: 5px;
}

/* last container */
div.nblast {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput div.prompt,
div.nboutput div.prompt {
    min-width: 5ex;
    padding-top: 0.4em;
    padding-right: 0.4em;
    text-align: right;
    flex: 0;
}
@media (max-width: 540px) {
    div.nbinput div.prompt,
    div.nboutput div.prompt {
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput div.prompt.empty {
        padding: 0;
    }
}

/* disable scrollbars on prompts */
div.nbinput div.prompt pre,
div.nboutput div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput div.input_area,
div.nboutput div.output_area {
    padding: 0.4em;
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput div.input_area,
    div.nboutput div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    background: #f5f5f5;
}

/* override MathJax center alignment in output cells */
div.nboutput div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput div.math p {
    text-align: left;
}

/* standard error */
div.nboutput div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast,
.nboutput.nblast {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast + .nbinput {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="Extracting-contour-lines">
<h1>Extracting contour lines<a class="headerlink" href="#Extracting-contour-lines" title="Permalink to this headline">¶</a></h1>
<p><strong>What does this notebook do?</strong></p>
<p>This notebook demonstrates how to use the <code class="docutils literal notranslate"><span class="pre">contour_extract</span></code> function to extract multiple contours from a two-dimensional array, or individual contours from every array along a specified dimension in a multi-dimensional array. Contours can be extracted either from digital elevation data (DEMs), or from any other data such as extracting waterline boundaries from Landsat-derived Normalized Difference Water Index (NDWI) data across time.</p>
<p><strong>Requirements:</strong></p>
<p>You need to run the following commands from the command line prior to launching jupyter notebooks from the same terminal so that the required libraries and paths are set:</p>
<p><code class="docutils literal notranslate"><span class="pre">module</span> <span class="pre">use</span> <span class="pre">/g/data/v10/public/modules/modulefiles</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">module</span> <span class="pre">load</span> <span class="pre">dea</span></code></p>
<p>This notebook uses an external function called <code class="docutils literal notranslate"><span class="pre">contour_extract</span></code>. This function is available in the <code class="docutils literal notranslate"><span class="pre">10_Scripts</span></code> folder of the <a class="reference external" href="https://github.com/GeoscienceAustralia/dea-notebooks/tree/master/10_Scripts">dea-notebooks Github repository</a>. Note that these functions have been developed by DEA users, not the DEA development team, and so are provided without warranty. If you find an error or bug in the functions, please either create an ‘Issue’ in the Github repository, or fix it yourself and
create a ‘Pull’ request to contribute the updated function back into the repository (See the repository <a class="reference external" href="https://github.com/GeoscienceAustralia/dea-notebooks/blob/master/README.rst">README</a> for instructions on creating a Pull request).</p>
<p><strong>Date:</strong> November 2018</p>
<p><strong>Author:</strong> Robbi Bishop-Taylor</p>
<p><strong>Tags</strong>: <span class="target" id="index-0"></span>srtm, <span class="target" id="index-1"></span>Scripts, <span class="target" id="index-2"></span>contours, <span class="target" id="index-3"></span>elevation, <span class="target" id="index-4"></span>Outputting data, <span class="target" id="index-5"></span>Landsat, <span class="target" id="index-6"></span>Landsat8, <span class="target" id="index-7"></span>NDWI, <span class="target" id="index-8"></span>query, <span class="target" id="index-9"></span>dc.load, <span class="target" id="index-10"></span>plot, <span class="target" id="index-11"></span>skimage.measure, <span class="target" id="index-12"></span>Image processing</p>
<div class="section" id="Load-modules">
<h2>Load modules<a class="headerlink" href="#Load-modules" title="Permalink to this headline">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Import modules</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">datacube</span>
<span class="kn">import</span> <span class="nn">geopandas</span> <span class="k">as</span> <span class="nn">gpd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="c1"># Import external dea-notebooks functions using relative link to Scripts directory</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;../10_Scripts&#39;</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">SpatialTools</span>

<span class="c1"># Set up datacube instance</span>
<span class="n">dc</span> <span class="o">=</span> <span class="n">datacube</span><span class="o">.</span><span class="n">Datacube</span><span class="p">(</span><span class="n">app</span><span class="o">=</span><span class="s1">&#39;Contour extraction&#39;</span><span class="p">)</span>

</pre></div>
</div>
</div>
</div>
<div class="section" id="Load-in-elevation-data">
<h2>Load in elevation data<a class="headerlink" href="#Load-in-elevation-data" title="Permalink to this headline">¶</a></h2>
<p>Here we use <code class="docutils literal notranslate"><span class="pre">dc.load</span></code> to import Shuttle Radar Topography Mission (SRTM) Digital Elevation Model (DEM) data for Canberra. This returns a hydrologically enforced digital elevation model (DEM-H):</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Elevation query</span>
<span class="n">elevation_query</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;lat&#39;</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="mf">35.25</span><span class="p">,</span> <span class="o">-</span><span class="mf">35.35</span><span class="p">),</span>
        <span class="s1">&#39;lon&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">149.05</span><span class="p">,</span> <span class="mf">149.17</span><span class="p">),</span>
        <span class="s1">&#39;output_crs&#39;</span><span class="p">:</span> <span class="s1">&#39;EPSG:3577&#39;</span><span class="p">,</span>
        <span class="s1">&#39;resolution&#39;</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="mi">25</span><span class="p">,</span> <span class="mi">25</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1"># Load in DEM data</span>
<span class="n">elevation_data</span> <span class="o">=</span> <span class="n">dc</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">product</span><span class="o">=</span><span class="s1">&#39;srtm_dem1sv1_0&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">elevation_query</span><span class="p">)</span>
<span class="n">elevation_data</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>&lt;xarray.Dataset&gt;
Dimensions:  (time: 1, x: 492, y: 500)
Coordinates:
  * time     (time) datetime64[ns] 2014-12-15T14:58:44
  * y        (y) float64 -3.953e+06 -3.953e+06 ... -3.966e+06 -3.966e+06
  * x        (x) float64 1.542e+06 1.542e+06 1.542e+06 ... 1.555e+06 1.555e+06
Data variables:
    dem      (time, y, x) float32 653.0692 652.3962 651.54095 ... 583.0 582.0
    dem_s    (time, y, x) float32 651.44354 651.31757 ... 583.69037 582.87164
    dem_h    (time, y, x) float32 651.2039 651.0723 ... 583.68713 582.76434
Attributes:
    crs:      EPSG:3577
</pre></div>
</div>
</div>
<p>Create a terrain-coloured colour map and plot the DEM-H data:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Create a custom colourmap for the DEM</span>
<span class="n">colors_terrain</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">terrain</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.08</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">200</span><span class="p">))</span>
<span class="n">cmap_terrain</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">LinearSegmentedColormap</span><span class="o">.</span><span class="n">from_list</span><span class="p">(</span><span class="s1">&#39;terrain&#39;</span><span class="p">,</span> <span class="n">colors_terrain</span><span class="p">)</span>

<span class="c1"># Plot the elevation; `squeeze` removes the uncessessary time dimension</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">elevation_data</span><span class="o">.</span><span class="n">dem_h</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">cmap</span><span class="o">=</span><span class="n">cmap_terrain</span><span class="p">)</span>

</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>&lt;matplotlib.collections.QuadMesh at 0x7fb27b0023c8&gt;
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/notebooks_07_Image_classification_ExtractingContourLines_8_1.png" src="../../_images/notebooks_07_Image_classification_ExtractingContourLines_8_1.png" />
</div>
</div>
</div>
<div class="section" id="Contour-extraction-in-'single-array,-multiple-z-values'-mode">
<h2>Contour extraction in ‘single array, multiple z-values’ mode<a class="headerlink" href="#Contour-extraction-in-'single-array,-multiple-z-values'-mode" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">SpatialTools.contour_extract</span></code> function uses <code class="docutils literal notranslate"><span class="pre">skimage.measure.find_contours</span></code> to extract contour lines from an array. This can be an elevation dataset like the data imported above, or any other two-dimensional or multi-dimensional array. We can extract contours from the elevation array imported above by providing a single z-value/elevation or a list of <code class="docutils literal notranslate"><span class="pre">z_values</span></code>/elevations. We also need to provide a <code class="docutils literal notranslate"><span class="pre">crs</span></code> and an <code class="docutils literal notranslate"><span class="pre">affine</span></code> object, both of which can be obtained from the xarray
DataArray.</p>
<div class="section" id="Extracting-a-single-contour">
<h3>Extracting a single contour<a class="headerlink" href="#Extracting-a-single-contour" title="Permalink to this headline">¶</a></h3>
<p>Here, we extract a single 600 m elevation contour:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[38]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Remove the time dimension to return a two-dimensional array. This is not strictly necessary as the</span>
<span class="c1"># function will drop the time dimension automatically if it has a length of 1, but it is good practice:</span>
<span class="n">elevation_2d</span> <span class="o">=</span> <span class="n">elevation_data</span><span class="o">.</span><span class="n">dem_h</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">)</span>

<span class="c1"># Extract contours</span>
<span class="n">contour_gdf</span> <span class="o">=</span> <span class="n">SpatialTools</span><span class="o">.</span><span class="n">contour_extract</span><span class="p">(</span><span class="n">z_values</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span>
                                            <span class="n">ds_array</span><span class="o">=</span><span class="n">elevation_2d</span><span class="p">,</span>
                                            <span class="n">ds_crs</span><span class="o">=</span><span class="n">elevation_2d</span><span class="o">.</span><span class="n">geobox</span><span class="o">.</span><span class="n">crs</span><span class="p">,</span>
                                            <span class="n">ds_affine</span><span class="o">=</span><span class="n">elevation_2d</span><span class="o">.</span><span class="n">geobox</span><span class="o">.</span><span class="n">affine</span><span class="p">,</span>
                                            <span class="n">output_shp</span><span class="o">=</span><span class="s1">&#39;extracted_contours.shp&#39;</span><span class="p">)</span>

<span class="c1"># Print output</span>
<span class="n">contour_gdf</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Operating in single array, multiple z-values mode
    Extracting contour 600
Exporting contour shapefile to extracted_contours.shp
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[38]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>z_value</th>
      <th>geometry</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>600.0</td>
      <td>(LINESTRING (1545252.210436996 -3953087.5, 154...</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>This writes the shapefile to file, and returns a Geopandas geodataframe containing a single contour line feature with the z-value (i.e. elevation) given in a shapefile field named <code class="docutils literal notranslate"><span class="pre">z_value</span></code>. We can plot this:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[39]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Plot extracted contour:</span>
<span class="n">contour_gdf</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[39]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>&lt;matplotlib.axes._subplots.AxesSubplot at 0x7fb27ac1b208&gt;
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/notebooks_07_Image_classification_ExtractingContourLines_12_1.png" src="../../_images/notebooks_07_Image_classification_ExtractingContourLines_12_1.png" />
</div>
</div>
</div>
<div class="section" id="Extracting-multiple-contours">
<h3>Extracting multiple contours<a class="headerlink" href="#Extracting-multiple-contours" title="Permalink to this headline">¶</a></h3>
<p>We can easily import multiple contours from a single array by supplying a list of z-values to extract. The function will then extract a contour for each value in <code class="docutils literal notranslate"><span class="pre">z_values</span></code>, skipping any contour elevation that is not found in the array (e.g. 850 m below):</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[40]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># List of elevations to extract</span>
<span class="n">elev_list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">550</span><span class="p">,</span> <span class="mi">600</span><span class="p">,</span> <span class="mi">650</span><span class="p">,</span> <span class="mi">700</span><span class="p">,</span> <span class="mi">750</span><span class="p">,</span> <span class="mi">800</span><span class="p">,</span> <span class="mi">850</span><span class="p">]</span>

<span class="c1"># Extract contours</span>
<span class="n">contour_gdf</span> <span class="o">=</span> <span class="n">SpatialTools</span><span class="o">.</span><span class="n">contour_extract</span><span class="p">(</span><span class="n">z_values</span><span class="o">=</span><span class="n">elev_list</span><span class="p">,</span>
                                            <span class="n">ds_array</span><span class="o">=</span><span class="n">elevation_2d</span><span class="p">,</span>
                                            <span class="n">ds_crs</span><span class="o">=</span><span class="n">elevation_2d</span><span class="o">.</span><span class="n">geobox</span><span class="o">.</span><span class="n">crs</span><span class="p">,</span>
                                            <span class="n">ds_affine</span><span class="o">=</span><span class="n">elevation_2d</span><span class="o">.</span><span class="n">geobox</span><span class="o">.</span><span class="n">affine</span><span class="p">,</span>
                                            <span class="n">output_shp</span><span class="o">=</span><span class="s1">&#39;extracted_contours.shp&#39;</span><span class="p">)</span>

<span class="c1"># Plot extracted contours, colouring contours by their z-value/elevation:</span>
<span class="n">contour_gdf</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="s1">&#39;z_value&#39;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Operating in single array, multiple z-values mode
    Extracting contour 550
    Extracting contour 600
    Extracting contour 650
    Extracting contour 700
    Extracting contour 750
    Extracting contour 800
    Extracting contour 850
    No data for contour 850; skipping
Exporting contour shapefile to extracted_contours.shp
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[40]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>&lt;matplotlib.axes._subplots.AxesSubplot at 0x7fb268aec780&gt;
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/notebooks_07_Image_classification_ExtractingContourLines_14_2.png" src="../../_images/notebooks_07_Image_classification_ExtractingContourLines_14_2.png" />
</div>
</div>
<p>Any number of contours can be extracted; below we extract one contour for every 10 m in elevation. For this kind of extraction, it can be useful to use the <code class="docutils literal notranslate"><span class="pre">verbose=False</span></code> parameter to prevent the large number of contour extractions being printed to the screen:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[41]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># List of elevations to extract</span>
<span class="n">elev_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">510</span><span class="p">,</span> <span class="mi">840</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>

<span class="c1">#Extract contours and export to a shapefile</span>
<span class="n">contour_gdf</span> <span class="o">=</span> <span class="n">SpatialTools</span><span class="o">.</span><span class="n">contour_extract</span><span class="p">(</span><span class="n">z_values</span><span class="o">=</span><span class="n">elev_list</span><span class="p">,</span>
                                           <span class="n">ds_array</span><span class="o">=</span><span class="n">elevation_2d</span><span class="p">,</span>
                                           <span class="n">ds_crs</span><span class="o">=</span><span class="n">elevation_data</span><span class="o">.</span><span class="n">geobox</span><span class="o">.</span><span class="n">crs</span><span class="p">,</span>
                                           <span class="n">ds_affine</span><span class="o">=</span><span class="n">elevation_data</span><span class="o">.</span><span class="n">geobox</span><span class="o">.</span><span class="n">affine</span><span class="p">,</span>
                                           <span class="n">output_shp</span><span class="o">=</span><span class="s1">&#39;extracted_contours.shp&#39;</span><span class="p">,</span>
                                           <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># Plot extracted contours, colouring contours by their z-value/elevation:</span>
<span class="n">contour_gdf</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="s1">&#39;z_value&#39;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Operating in single array, multiple z-values mode
Exporting contour shapefile to extracted_contours.shp
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[41]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>&lt;matplotlib.axes._subplots.AxesSubplot at 0x7fb268b3e470&gt;
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/notebooks_07_Image_classification_ExtractingContourLines_16_2.png" src="../../_images/notebooks_07_Image_classification_ExtractingContourLines_16_2.png" />
</div>
</div>
<p>We can plot the contours over the top of the original elevation array to verify they are in the correct locations:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[42]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Plot contours over the top of elevation array</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">elevation_data</span><span class="o">.</span><span class="n">dem</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap_terrain</span><span class="p">)</span>
<span class="n">contour_gdf</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[42]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>&lt;matplotlib.axes._subplots.AxesSubplot at 0x7fb268a00ba8&gt;
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/notebooks_07_Image_classification_ExtractingContourLines_18_1.png" src="../../_images/notebooks_07_Image_classification_ExtractingContourLines_18_1.png" />
</div>
</div>
</div>
<div class="section" id="Custom-shapefile-attributes">
<h3>Custom shapefile attributes<a class="headerlink" href="#Custom-shapefile-attributes" title="Permalink to this headline">¶</a></h3>
<p>By default, the shapefile includes a single <code class="docutils literal notranslate"><span class="pre">z_value</span></code> attribute field with one feature per input value in <code class="docutils literal notranslate"><span class="pre">z_values</span></code>. We can instead pass custom attributes to the output shapefile using the <code class="docutils literal notranslate"><span class="pre">attribute_data</span></code> and <code class="docutils literal notranslate"><span class="pre">attribute_dtypes</span></code> parameters. For example, we might want a custom column called <code class="docutils literal notranslate"><span class="pre">elev_cm</span></code> with heights in cm instead of m, and a <code class="docutils literal notranslate"><span class="pre">location</span></code> column giving the location (Canberra).</p>
<p>We can achieve this by passing in a dict with field names as keys, and a list of values of the same length as <code class="docutils literal notranslate"><span class="pre">z_values</span></code>. When passing in custom attributes, we also need to manually set the dtypes for the output fields using an <code class="docutils literal notranslate"><span class="pre">attribute_dtypes</span></code> dictionary. The dict should have the same keys/field names as declared in <code class="docutils literal notranslate"><span class="pre">attribute_data</span></code>, and values which include ‘int’, ‘str’, ‘datetime, and ‘float:X.Y’, where X is the minimum number of characters before the decimal place, and Y is the
number of characters after the decimal place:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[43]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Elevation values to extract</span>
<span class="n">elev_values</span> <span class="o">=</span> <span class="p">[</span><span class="mi">550</span><span class="p">,</span> <span class="mi">600</span><span class="p">,</span> <span class="mi">650</span><span class="p">,</span> <span class="mi">700</span><span class="p">,</span> <span class="mi">750</span><span class="p">,</span> <span class="mi">800</span><span class="p">,</span> <span class="mi">850</span><span class="p">]</span>

<span class="c1"># Set up dicts with the attribute field name as the dict key, and lists of values of the same</span>
<span class="c1"># length as `z_values`:</span>
<span class="n">custom_attrs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;elev_cm&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">55000</span><span class="p">,</span> <span class="mi">60000</span><span class="p">,</span> <span class="mi">65000</span><span class="p">,</span> <span class="mi">70000</span><span class="p">,</span> <span class="mi">75000</span><span class="p">,</span> <span class="mi">80000</span><span class="p">,</span> <span class="mi">85000</span><span class="p">],</span>
                <span class="s1">&#39;location&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;Canberra&#39;</span><span class="p">,</span> <span class="s1">&#39;Canberra&#39;</span><span class="p">,</span> <span class="s1">&#39;Canberra&#39;</span><span class="p">,</span> <span class="s1">&#39;Canberra&#39;</span><span class="p">,</span>
                             <span class="s1">&#39;Canberra&#39;</span><span class="p">,</span> <span class="s1">&#39;Canberra&#39;</span><span class="p">,</span> <span class="s1">&#39;Canberra&#39;</span><span class="p">]}</span>
<span class="n">custom_attrs_dtypes</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;elev_cm&#39;</span><span class="p">:</span> <span class="s1">&#39;int&#39;</span><span class="p">,</span> <span class="s1">&#39;location&#39;</span><span class="p">:</span> <span class="s1">&#39;str&#39;</span><span class="p">}</span>

<span class="c1"># Extract contours with custom attribute fields:</span>
<span class="n">contour_dict</span> <span class="o">=</span> <span class="n">SpatialTools</span><span class="o">.</span><span class="n">contour_extract</span><span class="p">(</span><span class="n">z_values</span><span class="o">=</span><span class="n">elev_values</span><span class="p">,</span>
                                            <span class="n">ds_array</span><span class="o">=</span><span class="n">elevation_data</span><span class="o">.</span><span class="n">dem_h</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">),</span>
                                            <span class="n">ds_crs</span><span class="o">=</span><span class="n">elevation_data</span><span class="o">.</span><span class="n">geobox</span><span class="o">.</span><span class="n">crs</span><span class="p">,</span>
                                            <span class="n">ds_affine</span><span class="o">=</span><span class="n">elevation_data</span><span class="o">.</span><span class="n">geobox</span><span class="o">.</span><span class="n">affine</span><span class="p">,</span>
                                            <span class="n">output_shp</span><span class="o">=</span><span class="s1">&#39;extracted_contours_attrs.shp&#39;</span><span class="p">,</span>
                                            <span class="n">attribute_data</span><span class="o">=</span><span class="n">custom_attrs</span><span class="p">,</span>
                                            <span class="n">attribute_dtypes</span><span class="o">=</span><span class="n">custom_attrs_dtypes</span><span class="p">)</span>

<span class="c1"># Import shapefile using geopandas to verify that the shapefile includes the new attributes:</span>
<span class="n">contour_shp</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="s1">&#39;extracted_contours_attrs.shp&#39;</span><span class="p">)</span>
<span class="n">contour_shp</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Operating in single array, multiple z-values mode
    Extracting contour 550
    Extracting contour 600
    Extracting contour 650
    Extracting contour 700
    Extracting contour 750
    Extracting contour 800
    Extracting contour 850
    No data for contour 850; skipping
Exporting contour shapefile to extracted_contours_attrs.shp
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[43]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>elev_cm</th>
      <th>location</th>
      <th>geometry</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>55000</td>
      <td>Canberra</td>
      <td>(LINESTRING (1542337.5 -3955470.764855981, 154...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>60000</td>
      <td>Canberra</td>
      <td>(LINESTRING (1545252.210436996 -3953087.5, 154...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>65000</td>
      <td>Canberra</td>
      <td>(LINESTRING (1543443.610875806 -3953087.5, 154...</td>
    </tr>
    <tr>
      <th>3</th>
      <td>70000</td>
      <td>Canberra</td>
      <td>(LINESTRING (1544862.5 -3955595.512401243, 154...</td>
    </tr>
    <tr>
      <th>4</th>
      <td>75000</td>
      <td>Canberra</td>
      <td>(LINESTRING (1553162.5 -3957020.618084073, 155...</td>
    </tr>
    <tr>
      <th>5</th>
      <td>80000</td>
      <td>Canberra</td>
      <td>(LINESTRING (1547737.5 -3956521.204322249, 154...</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
</div>
</div>
<div class="section" id="Contours-from-non-elevation-datasets-in-in-'single-z-value,-multiple-arrays'-mode">
<h2>Contours from non-elevation datasets in in ‘single z-value, multiple arrays’ mode<a class="headerlink" href="#Contours-from-non-elevation-datasets-in-in-'single-z-value,-multiple-arrays'-mode" title="Permalink to this headline">¶</a></h2>
<p>As well as extracting multiple contours from a single two-dimensional array, <code class="docutils literal notranslate"><span class="pre">contour_extract</span></code> also allows you to extract a single z-value from every array along a specified dimension in a multi-dimensional array. This can be useful for comparing the changing topography of a landscape across time. The input multi-dimensional array does not need to be elevation data: contours can be extracted from any type of data. For example, we can use the function to extract the boundary between land and
water.</p>
<p>First, import some sample Landsat data and calculate a simple Normalized Difference Water Index (NDWI) on two cloud-free images. This index will have high values where a pixel is likely to be open water (e.g. NDWI &gt; 0, or red colours below):</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[67]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Landsat query</span>
<span class="n">landsat_query</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;lat&#39;</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="mf">35.25</span><span class="p">,</span> <span class="o">-</span><span class="mf">35.35</span><span class="p">),</span>
        <span class="s1">&#39;lon&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">149.05</span><span class="p">,</span> <span class="mf">149.17</span><span class="p">),</span>
        <span class="s1">&#39;time&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;2018-01-10&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-04-20&#39;</span><span class="p">),</span>
        <span class="s1">&#39;measurements&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="s1">&#39;nir&#39;</span><span class="p">],</span>
        <span class="s1">&#39;output_crs&#39;</span><span class="p">:</span> <span class="s1">&#39;EPSG:3577&#39;</span><span class="p">,</span>
        <span class="s1">&#39;resolution&#39;</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="mi">25</span><span class="p">,</span> <span class="mi">25</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1"># Load Landsat 8 data</span>
<span class="n">landsat_data</span> <span class="o">=</span> <span class="n">dc</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">product</span><span class="o">=</span><span class="s1">&#39;ls8_nbart_albers&#39;</span><span class="p">,</span>
                       <span class="n">group_by</span> <span class="o">=</span> <span class="s1">&#39;solar_day&#39;</span><span class="p">,</span>
                       <span class="o">**</span><span class="n">landsat_query</span><span class="p">)</span>

<span class="c1"># Pull out two cloud-free observations</span>
<span class="n">landsat_data</span> <span class="o">=</span> <span class="n">landsat_data</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">12</span><span class="p">])</span>

<span class="c1"># Compute NDWI</span>
<span class="n">landsat_ndwi</span> <span class="o">=</span> <span class="p">(</span><span class="n">landsat_data</span><span class="o">.</span><span class="n">green</span> <span class="o">-</span> <span class="n">landsat_data</span><span class="o">.</span><span class="n">nir</span><span class="p">)</span> <span class="o">/</span> \
               <span class="p">(</span><span class="n">landsat_data</span><span class="o">.</span><span class="n">green</span> <span class="o">+</span> <span class="n">landsat_data</span><span class="o">.</span><span class="n">nir</span><span class="p">)</span>

<span class="c1"># Plot</span>
<span class="n">landsat_ndwi</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">col</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=-</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;RdYlBu&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[67]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>&lt;xarray.plot.facetgrid.FacetGrid at 0x7fb2367e9be0&gt;
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/notebooks_07_Image_classification_ExtractingContourLines_22_1.png" src="../../_images/notebooks_07_Image_classification_ExtractingContourLines_22_1.png" />
</div>
</div>
<p>We can now identify the land-water boundary by extracting the 0 NDWI contour for each array in the dataset along the <code class="docutils literal notranslate"><span class="pre">time</span></code> dimension. By plotting the resulting contour lines, we can then start to compare phenomenon like lake levels across time:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[68]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Extract contours with custom attribute fields:</span>
<span class="n">contour_gdf</span> <span class="o">=</span> <span class="n">SpatialTools</span><span class="o">.</span><span class="n">contour_extract</span><span class="p">(</span><span class="n">z_values</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                           <span class="n">ds_array</span><span class="o">=</span><span class="n">landsat_ndwi</span><span class="p">,</span>
                                           <span class="n">ds_crs</span><span class="o">=</span><span class="n">elevation_data</span><span class="o">.</span><span class="n">geobox</span><span class="o">.</span><span class="n">crs</span><span class="p">,</span>
                                           <span class="n">ds_affine</span><span class="o">=</span><span class="n">elevation_data</span><span class="o">.</span><span class="n">geobox</span><span class="o">.</span><span class="n">affine</span><span class="p">,</span>
                                           <span class="n">output_shp</span><span class="o">=</span><span class="s1">&#39;extracted_contours_ndwi.shp&#39;</span><span class="p">)</span>

<span class="c1"># Plot contours over the top of array</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">landsat_ndwi</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">270</span><span class="p">,</span> <span class="mi">290</span><span class="p">),</span> <span class="n">y</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">240</span><span class="p">,</span> <span class="mi">260</span><span class="p">))</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=-</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;RdYlBu&#39;</span><span class="p">)</span>
<span class="n">contour_gdf</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Operating in single z-value, multiple arrays mode
    Extracting contour 0
    Extracting contour 1
Exporting contour shapefile to extracted_contours_ndwi.shp
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[68]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>&lt;matplotlib.axes._subplots.AxesSubplot at 0x7fb23673aef0&gt;
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/notebooks_07_Image_classification_ExtractingContourLines_24_2.png" src="../../_images/notebooks_07_Image_classification_ExtractingContourLines_24_2.png" />
</div>
</div>
<div class="section" id="Dropping-small-contours">
<h3>Dropping small contours<a class="headerlink" href="#Dropping-small-contours" title="Permalink to this headline">¶</a></h3>
<p>Contours produced by <code class="docutils literal notranslate"><span class="pre">contour_extract</span></code> can include many small features. We can optionally choose to extract only contours larger than a certain number of vertices using the <code class="docutils literal notranslate"><span class="pre">min_vertices</span></code> parameter. This can be useful for focusing on large contours, and remove possible noise in a dataset. Here we set <code class="docutils literal notranslate"><span class="pre">min_vertices=20</span></code> to keep only contours with at least 20 vertices. Observe the small waterbody in the bottom-right of the image disappear:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[69]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Extract contours with custom attribute fields:</span>
<span class="n">contour_dict</span> <span class="o">=</span> <span class="n">SpatialTools</span><span class="o">.</span><span class="n">contour_extract</span><span class="p">(</span><span class="n">z_values</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                            <span class="n">ds_array</span><span class="o">=</span><span class="n">landsat_ndwi</span><span class="p">,</span>
                                            <span class="n">ds_crs</span><span class="o">=</span><span class="n">elevation_data</span><span class="o">.</span><span class="n">geobox</span><span class="o">.</span><span class="n">crs</span><span class="p">,</span>
                                            <span class="n">ds_affine</span><span class="o">=</span><span class="n">elevation_data</span><span class="o">.</span><span class="n">geobox</span><span class="o">.</span><span class="n">affine</span><span class="p">,</span>
                                            <span class="n">output_shp</span><span class="o">=</span><span class="s1">&#39;extracted_contours_ndwi.shp&#39;</span><span class="p">,</span>
                                            <span class="n">min_vertices</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>

<span class="c1"># Import shapefile using geopandas to verify that the shapefile includes the new attributes:</span>
<span class="n">contour_shp</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="s1">&#39;extracted_contours_ndwi.shp&#39;</span><span class="p">)</span>
<span class="n">contour_shp</span>

<span class="c1"># Plot contours over the top of elevation array</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">landsat_ndwi</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">270</span><span class="p">,</span> <span class="mi">290</span><span class="p">),</span> <span class="n">y</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">240</span><span class="p">,</span> <span class="mi">260</span><span class="p">))</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=-</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;RdYlBu&#39;</span><span class="p">)</span>
<span class="n">contour_shp</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>

</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Operating in single z-value, multiple arrays mode
    Extracting contour 0
    Extracting contour 1
Exporting contour shapefile to extracted_contours_ndwi.shp
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[69]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>&lt;matplotlib.axes._subplots.AxesSubplot at 0x7fb2368505c0&gt;
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/notebooks_07_Image_classification_ExtractingContourLines_26_2.png" src="../../_images/notebooks_07_Image_classification_ExtractingContourLines_26_2.png" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>
</pre></div>
</div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="FindDamsUsingWOFLs.html" class="btn btn-neutral float-right" title="Find dams using WOFLs" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="DEA_WOfS_and_water_classifier.html" class="btn btn-neutral float-left" title="DEA WOfS and Water Classifier Notebook" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017-2018, Geoscience Australia

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
    <!-- Theme Analytics -->
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-113800428-1', 'auto');
    ga('send', 'pageview');
    </script>

    
  


<!-- Theme Analytics -->
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-113800428-1"></script>
<script>
 window.dataLayer = window.dataLayer || [];
 function gtag(){dataLayer.push(arguments);}
 gtag('js', new Date());
 
 gtag('config', 'UA-113800428-1');
</script>

    
  


</body>
</html>