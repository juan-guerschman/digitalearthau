


<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Introduction to Sentinel 2 &mdash; Digital Earth Australia 1.0.0 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../../_static/dea-favicon.ico"/>
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="https://unpkg.com/font-awesome@4.5.0/css/font-awesome.min.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/custom.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Getting started with High-Low Tide Composites (HLTC_25)" href="Introduction_to_HLTC.html" />
    <link rel="prev" title="Introduction to Fractional Cover Data" href="Introduction_to_Fractional_Cover.html" /> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html">
          

          
            
            <img src="../../_static/dea-logo-inline.svg" class="logo" alt="Logo"/>
          
          </a>

          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Overview</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../about/intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../about/glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../about/changelog.html">DEA NCI Environment Changelog</a></li>
</ul>
<p class="caption"><span class="caption-text">Connect</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../connect/account.html">NCI Account Registration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../connect/install.html">Installation and Software Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../connect/get_help.html">Getting help</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../connect/nci_basics.html">Command Line Usage (Advanced)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../connect/jupyter.html">Jupyter Notebooks Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../internal/other_modules.html">Other Modules</a></li>
</ul>
<p class="caption"><span class="caption-text">User Guide</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../01_Getting_started/README.html">Getting Started</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="README.html">DEA Datasets</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="Introduction_to_Landsat.html">Introduction to DEA Landsat surface reflectance</a></li>
<li class="toctree-l2"><a class="reference internal" href="Introduction_to_LandsatPQ.html">Introduction to Landsat pixel quality (PQ25)</a></li>
<li class="toctree-l2"><a class="reference internal" href="Introduction_to_Fractional_Cover.html">Introduction to Fractional Cover Data</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Introduction to Sentinel 2</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Sentinel-2-products-currently-available">Sentinel 2 products currently available</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Loading-Sentinel-2-data">Loading Sentinel 2 data</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#See-what-came-back-from-the-extraction">See what came back from the extraction</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Sentinel-2-bands">Sentinel 2 bands</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Data-corrections">Data corrections</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Dealing-with-missing-data">Dealing with missing data</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Plot-as-a-true-colour-image">Plot as a true colour image</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Plot-as-a-false-colour-image">Plot as a false colour image</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Compare-observations-side-by-side">Compare observations side-by-side</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#Filter-scenes-using-pixel-quality">Filter scenes using pixel quality</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Plot-pixel-quality-information">Plot pixel quality information</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Use-pixel-quality-information-to-create-a-mask,-and-apply-it-to-the-spectral-data">Use pixel quality information to create a mask, and apply it to the spectral data</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Plot-cloud-masked-image">Plot cloud-masked image</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#Use-load_clearsentinel2-to-automatically-load-cloud-free-observations">Use <code class="docutils literal notranslate"><span class="pre">load_clearsentinel2</span></code> to automatically load cloud free observations</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Returning-only-cloud-free-images">Returning only cloud-free images</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="Introduction_to_HLTC.html">Getting started with High-Low Tide Composites (HLTC_25)</a></li>
<li class="toctree-l2"><a class="reference internal" href="Introduction_to_ITEM.html">Getting started with the Intertidal Extents Relative Model and ITEM Confidence (ITEM v2.0)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../03_Integrating_external_data/README.html">Integrating External Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../04_Index_calculation/README.html">Index Calculation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../05_Temporal_analysis/README.html">Temporal Analyses</a></li>
<li class="toctree-l1"><a class="reference internal" href="../06_Composite_generation/README.html">Composite Generation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../07_Image_classification/README.html">Image Classification</a></li>
<li class="toctree-l1"><a class="reference internal" href="../08_Outputting_data/README.html">Outputting data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../09_Workflows/README.html">Workflows</a></li>
<li class="toctree-l1"><a class="reference internal" href="../10_Scripts/README.html">Scripts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Supplementary_data/README.html">Supplementary Data</a></li>
</ul>
<p class="caption"><span class="caption-text">Data Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../data/data.html">Surface Reflectance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../data/s3.html">Products Available on Amazon S3</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../data/s3-sftp.html">Bulk download products from Amazon S3</a></li>
</ul>
<p class="caption"><span class="caption-text">Developer Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../internal/new_product.html">Creating a New Product</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../internal/git_best_practice.html">Git Best Practice</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../internal/release.html">DEA Release Process</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../internal/modules.html">DEA Modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../internal/collection_management.html">Collection Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../internal/requirements_met.html">DEA Code Functionality Examples</a></li>
</ul>
<p class="caption"><span class="caption-text">Indexes</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../genindex.html">Tags Index</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Digital Earth Australia</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="README.html">DEA Datasets</a> &raquo;</li>
        
      <li>Introduction to Sentinel 2</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/notebooks/02_DEA_datasets/Introduction_to_Sentinel2.ipynb.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput,
div.nbinput div.prompt,
div.nbinput div.input_area,
div.nbinput div[class*=highlight],
div.nbinput div[class*=highlight] pre,
div.nboutput,
div.nbinput div.prompt,
div.nbinput div.output_area,
div.nboutput div[class*=highlight],
div.nboutput div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput,
div.nboutput {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput,
    div.nboutput {
        flex-direction: column;
    }
}

/* input container */
div.nbinput {
    padding-top: 5px;
}

/* last container */
div.nblast {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput div.prompt pre {
    color: #303F9F;
}

/* output prompt */
div.nboutput div.prompt pre {
    color: #D84315;
}

/* all prompts */
div.nbinput div.prompt,
div.nboutput div.prompt {
    min-width: 8ex;
    padding-top: 0.4em;
    padding-right: 0.4em;
    text-align: right;
    flex: 0;
}
@media (max-width: 540px) {
    div.nbinput div.prompt,
    div.nboutput div.prompt {
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput div.prompt.empty {
        padding: 0;
    }
}

/* disable scrollbars on prompts */
div.nbinput div.prompt pre,
div.nboutput div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput div.input_area,
div.nboutput div.output_area {
    padding: 0.4em;
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput div.input_area,
    div.nboutput div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput div.input_area {
    border: 1px solid #cfcfcf;
    border-radius: 2px;
    background: #f7f7f7;
}

/* override MathJax center alignment in output cells */
div.nboutput div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.pngmath center alignment in output cells */
div.nboutput div.math p {
    text-align: left;
}

/* standard error */
div.nboutput div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast,
.nboutput.nblast {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast + .nbinput {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}
</style>
<div class="section" id="Introduction-to-Sentinel-2">
<h1>Introduction to Sentinel 2<a class="headerlink" href="#Introduction-to-Sentinel-2" title="Permalink to this headline">¶</a></h1>
<p><strong>What does this notebook do?</strong> This notebook steps you through how to
load in and plot up data from Sentinel 2. It explores the data that are
available from the Sentinel 2 satellite, and briefly describes the
Sentinel satellite bands. It then loads in the <code class="docutils literal notranslate"><span class="pre">s2a_ard_granule</span></code>
product and plots it up in true and false colour. It uses the provided
pixel quality data to filters the example scene based on <code class="docutils literal notranslate"><span class="pre">cloud</span></code> and
<code class="docutils literal notranslate"><span class="pre">cloud</span> <span class="pre">shadow</span></code>-free pixels.</p>
<p><strong>Before you run this notebook:</strong> You need to run the following commands
from the command line prior to launching jupyter notebook from the same
terminal so that the required libraries and paths are set.</p>
<p><code class="docutils literal notranslate"><span class="pre">module</span> <span class="pre">use</span> <span class="pre">/g/data/v10/public/modules/modulefiles</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">module</span> <span class="pre">load</span> <span class="pre">dea</span></code></p>
<p><strong>Date</strong>: November 2018</p>
<p><strong>Author</strong>: Claire Krause, Robbi Bishop-Taylor</p>
<p>Tags: <span class="target" id="index-0"></span>Sentinel2, <span class="target" id="index-1"></span>products, <span class="target" id="index-2"></span>DEAPlotting, <span class="target" id="index-3"></span>rgb, <span class="target" id="index-4"></span>dc.list_products, <span class="target" id="index-5"></span>dc.load, <span class="target" id="index-6"></span>query, <span class="target" id="index-7"></span>beginner, <span class="target" id="index-8"></span>plot, <span class="target" id="index-9"></span>image, <span class="target" id="index-10"></span>pixelquality</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">%</span><span class="k">matplotlib</span> inline
<span class="kn">from</span> <span class="nn">datacube.storage</span> <span class="k">import</span> <span class="n">masking</span>
<span class="kn">from</span> <span class="nn">datacube</span> <span class="k">import</span> <span class="n">Datacube</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="k">import</span> <span class="n">datetime</span>
<span class="kn">from</span> <span class="nn">skimage</span> <span class="k">import</span> <span class="n">exposure</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="c1"># Point this to where you have the algorithms from the dea-notebooks/algorithms saved</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="s1">&#39;../10_Scripts&#39;</span><span class="p">))</span>
<span class="kn">import</span> <span class="nn">DEAPlotting</span>
<span class="kn">import</span> <span class="nn">DEADataHandling</span>

<span class="c1"># Connect to datacube</span>
<span class="n">dc</span> <span class="o">=</span> <span class="n">Datacube</span><span class="p">(</span><span class="n">app</span><span class="o">=</span><span class="s1">&#39;Intro to Sentinel2&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="Sentinel-2-products-currently-available">
<h2>Sentinel 2 products currently available<a class="headerlink" href="#Sentinel-2-products-currently-available" title="Permalink to this headline">¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">products</span> <span class="o">=</span> <span class="n">dc</span><span class="o">.</span><span class="n">list_products</span><span class="p">()</span>
<span class="n">display_columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;description&#39;</span><span class="p">,</span> <span class="s1">&#39;instrument&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;platform&#39;</span><span class="p">,</span> <span class="s1">&#39;product_type&#39;</span><span class="p">,</span> <span class="s1">&#39;crs&#39;</span><span class="p">,</span> <span class="s1">&#39;resolution&#39;</span><span class="p">]</span>
<span class="n">sentinel_products</span> <span class="o">=</span> <span class="n">products</span><span class="p">[</span><span class="n">products</span><span class="p">[</span><span class="s1">&#39;instrument&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;MSI&#39;</span><span class="p">][</span><span class="n">display_columns</span><span class="p">]</span>
<span class="n">sentinel_products</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[2]:
</pre></div>
</div>
<div class="output_area docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>name</th>
      <th>description</th>
      <th>instrument</th>
      <th>platform</th>
      <th>product_type</th>
      <th>crs</th>
      <th>resolution</th>
    </tr>
    <tr>
      <th>id</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>90</th>
      <td>s2a_ard_granule</td>
      <td>Sentinel-2A MSI ARD - NBAR NBART and Pixel Qua...</td>
      <td>MSI</td>
      <td>SENTINEL_2A</td>
      <td>S2MSIARD</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>92</th>
      <td>s2a_level1c_granule</td>
      <td>Sentinel-2A Level1C - Ortho Rectified Top of A...</td>
      <td>MSI</td>
      <td>Sentinel-2A</td>
      <td>S2MSI1C</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>91</th>
      <td>s2b_ard_granule</td>
      <td>Sentinel-2B MSI ARD - NBAR NBART and Pixel Qua...</td>
      <td>MSI</td>
      <td>SENTINEL_2B</td>
      <td>S2MSIARD</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>93</th>
      <td>s2b_level1c_granule</td>
      <td>Sentinel-2B Level1C - Ortho Rectified Top of A...</td>
      <td>MSI</td>
      <td>Sentinel-2B</td>
      <td>S2MSI1C</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>There are two spectral Sentinel satellites currently in DEA;
<strong>Sentinel-2A</strong> and <strong>Sentinel-2B</strong>. Sentinel-2A was launched on 23 June
2015 and Sentinel-2B followed on 7 March 2017.</p>
<p>Both of the Sentinel 2 satellites carries an innovative wide swath
high-resolution multispectral imager with 13 spectral bands. The mission
is based on a constellation of two identical satellites in the same
orbit, 180° apart for optimal coverage and data delivery. Together they
cover all Earth’s land surfaces, large islands, inland and coastal
waters every five days at the equator.</p>
<p>For more information on the Sentinel 2 platforms and applications, check
out the <a class="reference external" href="http://www.esa.int/Our_Activities/Observing_the_Earth/Copernicus/Sentinel-2">European Space Agency
website</a>.</p>
</div>
<div class="section" id="Loading-Sentinel-2-data">
<h2>Loading Sentinel 2 data<a class="headerlink" href="#Loading-Sentinel-2-data" title="Permalink to this headline">¶</a></h2>
<p>We will focus on data from the Sentinel-2a platform for this
demonstration, as there is more data available than 2b. To explore the
spectral datasets from Sentinel-2a, we will use the <code class="docutils literal notranslate"><span class="pre">s2a_ard_granule</span></code>
product. Sometimes multiple scenes are acquired by the satellite on the
same day. We want to group these together, and will use
<code class="docutils literal notranslate"><span class="pre">group_by='solar_day'</span></code> to do this.</p>
<p>To load in the Sentinel data, we have a number of options we can use in
building our data extraction query:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">lat</span></code>/<code class="docutils literal notranslate"><span class="pre">lon</span></code> - specify a bounding box for the extraction. Note
that a polygon can be used instead. See
<a class="reference external" href="https://datacube-core.readthedocs.io/en/stable/dev/generate/datacube.api.query.Query.html#datacube.api.query.Query">here</a>
for more details</li>
<li><code class="docutils literal notranslate"><span class="pre">output_crs</span></code> - the output coordinate reference system to project
the data into. The CRS you request will impact on the format for the
<code class="docutils literal notranslate"><span class="pre">resolution</span></code> query. Two handy CRSs are ‘EPSG:3577’, which is the
Australian Albers projected coordinate system, and ‘EPSG:4325’, which
is WGS84 a global geographic coordinate system.</li>
<li><code class="docutils literal notranslate"><span class="pre">resolution</span></code> - the requested output resolution for the data. If you
have selected a geographic coordinate system for the <code class="docutils literal notranslate"><span class="pre">output_crs</span></code>,
this will be in degrees. If you have selected a projected coordinate
system, this will be in metres.</li>
<li><code class="docutils literal notranslate"><span class="pre">time</span></code> - the time range for the query.</li>
</ul>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">query</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;lat&#39;</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="mf">35.27</span><span class="p">,</span> <span class="o">-</span><span class="mf">35.33</span><span class="p">),</span>
        <span class="s1">&#39;lon&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">149.07</span><span class="p">,</span> <span class="mf">149.15</span><span class="p">),</span>
        <span class="s1">&#39;output_crs&#39;</span><span class="p">:</span> <span class="s1">&#39;EPSG:3577&#39;</span><span class="p">,</span>
        <span class="s1">&#39;resolution&#39;</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">),</span>
        <span class="s1">&#39;time&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;2017-01-01&#39;</span><span class="p">,</span> <span class="s1">&#39;2017-02-01&#39;</span><span class="p">)</span>
        <span class="p">}</span>

<span class="n">Canberra</span> <span class="o">=</span> <span class="n">dc</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">product</span><span class="o">=</span><span class="s1">&#39;s2a_ard_granule&#39;</span><span class="p">,</span> <span class="n">group_by</span><span class="o">=</span><span class="s1">&#39;solar_day&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">query</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="See-what-came-back-from-the-extraction">
<h3>See what came back from the extraction<a class="headerlink" href="#See-what-came-back-from-the-extraction" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">Canberra</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[4]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>&lt;xarray.Dataset&gt;
Dimensions:                (time: 2, x: 405, y: 380)
Coordinates:
  * time                   (time) datetime64[ns] 2017-01-05T00:02:12.026000 2017-01-15T00:02:11.026000
  * y                      (y) float64 -3.956e+06 -3.956e+06 ... -3.963e+06
  * x                      (x) float64 1.544e+06 1.544e+06 ... 1.553e+06
Data variables:
    azimuthal_exiting      (time, y, x) float32 24.900135 ... 127.58696
    azimuthal_incident     (time, y, x) float32 23.90676 39.06566 ... 149.86623
    exiting                (time, y, x) float32 10.388568 13.48787 ... 2.201671
    incident               (time, y, x) float32 36.450188 ... 30.279655
    relative_azimuth       (time, y, x) float32 26.755356 ... 28.386116
    relative_slope         (time, y, x) float32 -0.9933758 ... 22.279266
    satellite_azimuth      (time, y, x) float32 100.571175 ... 100.57671
    satellite_view         (time, y, x) float32 4.7305017 4.72948 ... 4.0362
    solar_azimuth          (time, y, x) float32 73.81582 73.81592 ... 72.1906
    solar_zenith           (time, y, x) float32 30.208754 ... 31.745928
    terrain_shadow         (time, y, x) uint8 1 1 1 1 1 1 1 1 ... 1 1 1 1 1 1 1
    fmask                  (time, y, x) uint8 2 2 2 2 2 2 2 2 ... 2 2 2 2 2 2 2
    nbar_contiguity        (time, y, x) uint8 1 1 1 1 1 1 1 1 ... 1 1 1 1 1 1 1
    nbar_coastal_aerosol   (time, y, x) int16 822 807 784 784 ... 442 442 442
    nbar_blue              (time, y, x) int16 903 863 858 824 ... 480 300 279
    nbar_green             (time, y, x) int16 1051 1029 1013 987 ... 591 467 412
    nbar_red               (time, y, x) int16 1301 1269 1249 ... 618 343 367
    nbar_red_edge_1        (time, y, x) int16 1619 1539 1494 ... 648 805 685
    nbar_red_edge_2        (time, y, x) int16 1927 1862 1838 ... 1503 2163 1953
    nbar_red_edge_3        (time, y, x) int16 2308 2199 2170 ... 1916 2850 2938
    nbar_nir_1             (time, y, x) int16 2456 2350 2423 ... 1915 3377 2475
    nbar_nir_2             (time, y, x) int16 2658 2536 2533 ... 2198 3281 3346
    nbar_swir_2            (time, y, x) int16 2862 2780 2707 ... 1387 1525 1585
    nbar_swir_3            (time, y, x) int16 1817 1732 1675 ... 846 826 761
    nbart_contiguity       (time, y, x) uint8 1 1 1 1 1 1 1 1 ... 1 1 1 1 1 1 1
    nbart_coastal_aerosol  (time, y, x) int16 867 862 861 861 ... 432 432 432
    nbart_blue             (time, y, x) int16 954 936 946 917 ... 458 293 278
    nbart_green            (time, y, x) int16 1113 1118 1119 ... 564 454 409
    nbart_red              (time, y, x) int16 1384 1389 1392 ... 587 333 365
    nbart_red_edge_1       (time, y, x) int16 1712 1679 1659 ... 616 780 676
    nbart_red_edge_2       (time, y, x) int16 2037 2033 2040 ... 1429 2096 1928
    nbart_red_edge_3       (time, y, x) int16 2402 2340 2336 ... 1841 2781 2909
    nbart_nir_1            (time, y, x) int16 2566 2504 2614 ... 1839 3304 2464
    nbart_nir_2            (time, y, x) int16 2767 2697 2725 ... 2113 3202 3314
    nbart_swir_2           (time, y, x) int16 3031 3041 3013 ... 1317 1476 1564
    nbart_swir_3           (time, y, x) int16 1931 1906 1879 ... 801 798 751
Attributes:
    crs:      EPSG:3577
</pre></div>
</div>
</div>
</div>
<div class="section" id="Sentinel-2-bands">
<h3>Sentinel 2 bands<a class="headerlink" href="#Sentinel-2-bands" title="Permalink to this headline">¶</a></h3>
<p>Sentinel 2 satellites have 13 spectral channels:</p>
<table border="1" class="docutils">
<colgroup>
<col width="17%" />
<col width="23%" />
<col width="11%" />
<col width="20%" />
<col width="14%" />
<col width="14%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sentinel 2 bands</th>
<th class="head">DEA band name</th>
<th class="head">Band number</th>
<th class="head">Central wavelength (nm)</th>
<th class="head">Resolution (m)</th>
<th class="head">Bandwidth (nm)</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Coastal aerosol</td>
<td><code class="docutils literal notranslate"><span class="pre">nbar(t)_coastal_aerosol</span></code></td>
<td>1</td>
<td>443</td>
<td>60</td>
<td>20</td>
</tr>
<tr class="row-odd"><td>Blue</td>
<td><code class="docutils literal notranslate"><span class="pre">nbar(t)_blue</span></code></td>
<td>2</td>
<td>490</td>
<td>10</td>
<td>65</td>
</tr>
<tr class="row-even"><td>Green</td>
<td><code class="docutils literal notranslate"><span class="pre">nbar(t)_green</span></code></td>
<td>3</td>
<td>560</td>
<td>10</td>
<td>35</td>
</tr>
<tr class="row-odd"><td>Red</td>
<td><code class="docutils literal notranslate"><span class="pre">nbar(t)_red</span></code></td>
<td>4</td>
<td>665</td>
<td>10</td>
<td>30</td>
</tr>
<tr class="row-even"><td>Vegetation red edge</td>
<td><code class="docutils literal notranslate"><span class="pre">nbar(t)_red_edge_1</span></code></td>
<td>5</td>
<td>705</td>
<td>20</td>
<td>15</td>
</tr>
<tr class="row-odd"><td>Vegetation red edge</td>
<td><code class="docutils literal notranslate"><span class="pre">nbar(t)_red_edge_2</span></code></td>
<td>6</td>
<td>740</td>
<td>20</td>
<td>15</td>
</tr>
<tr class="row-even"><td>Vegetation red edge</td>
<td><code class="docutils literal notranslate"><span class="pre">nbar(t)_red_edge_3</span></code></td>
<td>7</td>
<td>783</td>
<td>20</td>
<td>20</td>
</tr>
<tr class="row-odd"><td>NIR</td>
<td><code class="docutils literal notranslate"><span class="pre">nbar(t)_nir_1</span></code></td>
<td>8</td>
<td>842</td>
<td>10</td>
<td>115</td>
</tr>
<tr class="row-even"><td>Narrow NIR</td>
<td><code class="docutils literal notranslate"><span class="pre">nbar(t)_nir_2</span></code></td>
<td>8A</td>
<td>865</td>
<td>20</td>
<td>20</td>
</tr>
<tr class="row-odd"><td>Water vapour</td>
<td>N/A</td>
<td>9</td>
<td>945</td>
<td>60</td>
<td>20</td>
</tr>
<tr class="row-even"><td>SWIR - Cirrus</td>
<td>N/A</td>
<td>10</td>
<td>1375</td>
<td>60</td>
<td>20</td>
</tr>
<tr class="row-odd"><td>SWIR</td>
<td><code class="docutils literal notranslate"><span class="pre">nbar(t)_swir_2</span></code></td>
<td>11</td>
<td>1610</td>
<td>20</td>
<td>90</td>
</tr>
<tr class="row-even"><td>SWIR</td>
<td><code class="docutils literal notranslate"><span class="pre">nbar(t)_swir_3</span></code></td>
<td>12</td>
<td>2190</td>
<td>20</td>
<td>180</td>
</tr>
</tbody>
</table>
<p>These bands cover the visible, near-infrared and short-wave infrared
wave lengths.</p>
<div class="figure" id="id1">
<img alt="Sentinel 2 bands" src="http://www.geosage.com/highview/figures/Sentinel2_Spectral_Bands.jpg" />
<p class="caption"><span class="caption-text">Sentinel 2 bands</span></p>
</div>
<p><strong>Note</strong> There are a number of additional datasets that are alse
returned from our query. These are a combination of datasets used in the
correction process, and layers relating to pixel quality. We will
explore the pixel quality layers below.</p>
</div>
<div class="section" id="Data-corrections">
<h3>Data corrections<a class="headerlink" href="#Data-corrections" title="Permalink to this headline">¶</a></h3>
<p>There are two corrections applied to the Sentinel data:</p>
<ol class="arabic">
<li><div class="first line-block">
<div class="line"><strong>NBAR (e.g. ``nbar_green``)</strong></div>
<div class="line">NBAR stands for Nadir-corrected BRDF Adjusted Reflectance, where</div>
</div>
<p>BRDF stands for Bidirectional reflectance distribution function The
approach involves atmospheric correction to compute surface-leaving
radiance, and bi-directional reflectance modelling to remove the
effects of topography and angular variation in reflectance.</p>
</li>
<li><div class="first line-block">
<div class="line"><strong>T_NBAR (e.g. ``nbart_green``)</strong></div>
<div class="line">Surface reflectance T_NBAR includes the terrain illumination</div>
</div>
<p>reflectance correction and has the same features of NBAR, along with
some additional features.</p>
</li>
</ol>
<p>For more information on these corrections, see the explanation on the
<a class="reference external" href="http://geoscienceaustralia.github.io/digitalearthau/data/data.html#">DEA surface reflectance
page</a>.</p>
</div>
<div class="section" id="Dealing-with-missing-data">
<h3>Dealing with missing data<a class="headerlink" href="#Dealing-with-missing-data" title="Permalink to this headline">¶</a></h3>
<p>Note that the <code class="docutils literal notranslate"><span class="pre">nbart</span></code> data insert a missing value (<code class="docutils literal notranslate"><span class="pre">-9999</span></code>) into the
dataset to denote a terrain shadow. This should be converted to a
<code class="docutils literal notranslate"><span class="pre">NaN</span></code> value before using this data to avoid treating it as a valid
value:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">Canberra</span> <span class="o">=</span> <span class="n">masking</span><span class="o">.</span><span class="n">mask_invalid_data</span><span class="p">(</span><span class="n">Canberra</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Plot-as-a-true-colour-image">
<h3>Plot as a true colour image<a class="headerlink" href="#Plot-as-a-true-colour-image" title="Permalink to this headline">¶</a></h3>
<p>True colour images approximate what the human eye sees when looking at a
landscape. Note that the function used for this true colour plot
enhances the contrast between the bands, resulting in a colour-enhanced
image.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">DEAPlotting</span><span class="o">.</span><span class="n">rgb</span><span class="p">(</span><span class="n">Canberra</span><span class="p">,</span> <span class="n">bands</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;nbart_red&#39;</span><span class="p">,</span> <span class="s1">&#39;nbart_green&#39;</span><span class="p">,</span> <span class="s1">&#39;nbart_blue&#39;</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/notebooks_02_DEA_datasets_Introduction_to_Sentinel2_16_0.png" src="../../_images/notebooks_02_DEA_datasets_Introduction_to_Sentinel2_16_0.png" />
</div>
</div>
</div>
<div class="section" id="Plot-as-a-false-colour-image">
<h3>Plot as a false colour image<a class="headerlink" href="#Plot-as-a-false-colour-image" title="Permalink to this headline">¶</a></h3>
<p>This plot uses the SWIR, NIR and green bands to accentuate the presence
of water in the landscape.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">DEAPlotting</span><span class="o">.</span><span class="n">rgb</span><span class="p">(</span><span class="n">Canberra</span><span class="p">,</span> <span class="n">bands</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;nbart_swir_2&#39;</span><span class="p">,</span> <span class="s1">&#39;nbart_nir_1&#39;</span><span class="p">,</span> <span class="s1">&#39;nbart_green&#39;</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/notebooks_02_DEA_datasets_Introduction_to_Sentinel2_18_0.png" src="../../_images/notebooks_02_DEA_datasets_Introduction_to_Sentinel2_18_0.png" />
</div>
</div>
</div>
<div class="section" id="Compare-observations-side-by-side">
<h3>Compare observations side-by-side<a class="headerlink" href="#Compare-observations-side-by-side" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Select multiple images to plot by giving a list of values to `index`.</span>
<span class="c1"># This example plots the first and the second image in the dataset:</span>
<span class="n">DEAPlotting</span><span class="o">.</span><span class="n">rgb</span><span class="p">(</span><span class="n">Canberra</span><span class="p">,</span> <span class="n">bands</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;nbart_swir_2&#39;</span><span class="p">,</span> <span class="s1">&#39;nbart_nir_1&#39;</span><span class="p">,</span> <span class="s1">&#39;nbart_green&#39;</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/notebooks_02_DEA_datasets_Introduction_to_Sentinel2_20_0.png" src="../../_images/notebooks_02_DEA_datasets_Introduction_to_Sentinel2_20_0.png" />
</div>
</div>
</div>
</div>
<div class="section" id="Filter-scenes-using-pixel-quality">
<h2>Filter scenes using pixel quality<a class="headerlink" href="#Filter-scenes-using-pixel-quality" title="Permalink to this headline">¶</a></h2>
<p>A pixel quality dataset (<code class="docutils literal notranslate"><span class="pre">fmask</span></code>) is provided alongside the spectral
data, which can be used to filter out noisy pixels. The key things we
want to filter are clouds and shadows.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">fmask</span></code> field contains values from 0 to 5.</p>
<table border="1" class="docutils">
<colgroup>
<col width="36%" />
<col width="64%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Value</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>0</td>
<td>Null</td>
</tr>
<tr class="row-odd"><td>1</td>
<td>Valid</td>
</tr>
<tr class="row-even"><td>2</td>
<td>Cloud</td>
</tr>
<tr class="row-odd"><td>3</td>
<td>Cloud shadow</td>
</tr>
<tr class="row-even"><td>4</td>
<td>Snow</td>
</tr>
<tr class="row-odd"><td>5</td>
<td>Water</td>
</tr>
</tbody>
</table>
<p>Here is the cloudy image we would like to mask:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">DEAPlotting</span><span class="o">.</span><span class="n">rgb</span><span class="p">(</span><span class="n">Canberra</span><span class="p">,</span> <span class="n">bands</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;nbar_swir_2&#39;</span><span class="p">,</span> <span class="s1">&#39;nbar_nir_1&#39;</span><span class="p">,</span> <span class="s1">&#39;nbar_green&#39;</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/notebooks_02_DEA_datasets_Introduction_to_Sentinel2_23_0.png" src="../../_images/notebooks_02_DEA_datasets_Introduction_to_Sentinel2_23_0.png" />
</div>
</div>
<div class="section" id="Plot-pixel-quality-information">
<h3>Plot pixel quality information<a class="headerlink" href="#Plot-pixel-quality-information" title="Permalink to this headline">¶</a></h3>
<p>Here we plot pixel quality information that corresponds to the
observation above. This data is stored in the <code class="docutils literal notranslate"><span class="pre">fmask</span></code> variable:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">Canberra</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">fmask</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[10]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>&lt;matplotlib.collections.QuadMesh at 0x7fe6ccc2ed30&gt;
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/notebooks_02_DEA_datasets_Introduction_to_Sentinel2_25_1.png" src="../../_images/notebooks_02_DEA_datasets_Introduction_to_Sentinel2_25_1.png" />
</div>
</div>
</div>
<div class="section" id="Use-pixel-quality-information-to-create-a-mask,-and-apply-it-to-the-spectral-data">
<h3>Use pixel quality information to create a mask, and apply it to the spectral data<a class="headerlink" href="#Use-pixel-quality-information-to-create-a-mask,-and-apply-it-to-the-spectral-data" title="Permalink to this headline">¶</a></h3>
<p>We want to filter out no data, cloud and cloud shadow, so we will use
the <code class="docutils literal notranslate"><span class="pre">fmask</span></code> values <code class="docutils literal notranslate"><span class="pre">0</span></code>, <code class="docutils literal notranslate"><span class="pre">2</span></code> and <code class="docutils literal notranslate"><span class="pre">3</span></code> for our filter.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Numpy&#39;s `isin` function tests whether a pixel&#39;s value is in `test_elements`. Because we want to</span>
<span class="c1"># discard pixels where this is the case (because these pixels represent nodata, cloud or cloud shadow),</span>
<span class="c1"># we also use `invert=True` to keep only good quality pixels</span>
<span class="n">clear_pixels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">Canberra</span><span class="o">.</span><span class="n">fmask</span><span class="p">,</span> <span class="n">test_elements</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">invert</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Use clear pixels as a mask to keep only clear pixels</span>
<span class="n">Clear_Canberra</span> <span class="o">=</span> <span class="n">Canberra</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">clear_pixels</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Plot-cloud-masked-image">
<h3>Plot cloud-masked image<a class="headerlink" href="#Plot-cloud-masked-image" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">DEAPlotting</span><span class="o">.</span><span class="n">rgb</span><span class="p">(</span><span class="n">Clear_Canberra</span><span class="p">,</span> <span class="n">bands</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;nbart_swir_2&#39;</span><span class="p">,</span> <span class="s1">&#39;nbart_nir_1&#39;</span><span class="p">,</span> <span class="s1">&#39;nbart_green&#39;</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/notebooks_02_DEA_datasets_Introduction_to_Sentinel2_29_0.png" src="../../_images/notebooks_02_DEA_datasets_Introduction_to_Sentinel2_29_0.png" />
</div>
</div>
</div>
</div>
<div class="section" id="Use-load_clearsentinel2-to-automatically-load-cloud-free-observations">
<h2>Use <code class="docutils literal notranslate"><span class="pre">load_clearsentinel2</span></code> to automatically load cloud free observations<a class="headerlink" href="#Use-load_clearsentinel2-to-automatically-load-cloud-free-observations" title="Permalink to this headline">¶</a></h2>
<p>To make loading Sentinel 2 data more convenient, the
<code class="docutils literal notranslate"><span class="pre">load_clearsentinel2</span></code> function was written to automate common tasks
like returning cloud-free time series:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">query</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;lat&#39;</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="mf">35.27</span><span class="p">,</span> <span class="o">-</span><span class="mf">35.33</span><span class="p">),</span>
        <span class="s1">&#39;lon&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">149.07</span><span class="p">,</span> <span class="mf">149.15</span><span class="p">),</span>
        <span class="s1">&#39;output_crs&#39;</span><span class="p">:</span> <span class="s1">&#39;EPSG:3577&#39;</span><span class="p">,</span>
        <span class="s1">&#39;resolution&#39;</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span>
        <span class="s1">&#39;time&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;2017-01-01&#39;</span><span class="p">,</span> <span class="s1">&#39;2017-02-01&#39;</span><span class="p">)</span>
        <span class="p">}</span>

<span class="c1"># The `load_clearsentinel2` can be given a query containing spatial and temporal bounds, and a list of bands to return.</span>
<span class="c1"># By setting `mask_pixel_quality=True`, the function will automatically remove nodata, cloud or cloud shadow pixels:</span>
<span class="n">Clear_Canberra</span> <span class="o">=</span> <span class="n">DEADataHandling</span><span class="o">.</span><span class="n">load_clearsentinel2</span><span class="p">(</span><span class="n">dc</span><span class="o">=</span><span class="n">dc</span><span class="p">,</span>
                                                     <span class="n">query</span><span class="o">=</span><span class="n">query</span><span class="p">,</span>
                                                     <span class="n">bands_of_interest</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;nbart_red&#39;</span><span class="p">,</span> <span class="s1">&#39;nbart_green&#39;</span><span class="p">,</span> <span class="s1">&#39;nbart_blue&#39;</span><span class="p">,</span>
                                                                        <span class="s1">&#39;nbart_nir_1&#39;</span><span class="p">,</span> <span class="s1">&#39;nbart_swir_2&#39;</span><span class="p">,</span> <span class="s1">&#39;nbart_swir_3&#39;</span><span class="p">),</span>
                                                     <span class="n">masked_prop</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                                     <span class="n">mask_pixel_quality</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Loading s2a pixel quality
    Loading 2 filtered s2a timesteps
Loading s2b pixel quality
    Skipping s2b; no valid data for query
Combining and sorting s2a data
    Replacing invalid -999 values with NaN (data will be coerced to float64)
</pre></div></div>
</div>
<p>We can plot the same observation as earlier to verify we get the same
result:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">DEAPlotting</span><span class="o">.</span><span class="n">rgb</span><span class="p">(</span><span class="n">Clear_Canberra</span><span class="p">,</span> <span class="n">bands</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;nbart_swir_2&#39;</span><span class="p">,</span> <span class="s1">&#39;nbart_nir_1&#39;</span><span class="p">,</span> <span class="s1">&#39;nbart_green&#39;</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/notebooks_02_DEA_datasets_Introduction_to_Sentinel2_33_0.png" src="../../_images/notebooks_02_DEA_datasets_Introduction_to_Sentinel2_33_0.png" />
</div>
</div>
<div class="section" id="Returning-only-cloud-free-images">
<h3>Returning only cloud-free images<a class="headerlink" href="#Returning-only-cloud-free-images" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">load_clearsentinel2</span></code> function also allows you to return only
images that contain greater than a given percentage of good quality
pixels. For example, this can be used to return only cloud-free images.
To do this, we specify a minimum proportion of good pixels using the
<code class="docutils literal notranslate"><span class="pre">masked_prop</span></code> argument (e.g. specifying 0.3 below will return only
images with more than 30% good quality, cloud-free pixels).</p>
<p><strong>Please note:</strong> the Sentinel 2 cloud masking algorithm currently
performs poorly over urban areas, where it commonly confuses buildings
with clouds. Because of this, you make need to use a small value for
<code class="docutils literal notranslate"><span class="pre">masked_prop</span></code> to ensure the algorithm does not discard an excessive
number of images.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">Clear_Canberra</span> <span class="o">=</span> <span class="n">DEADataHandling</span><span class="o">.</span><span class="n">load_clearsentinel2</span><span class="p">(</span><span class="n">dc</span><span class="o">=</span><span class="n">dc</span><span class="p">,</span>
                                                     <span class="n">query</span><span class="o">=</span><span class="n">query</span><span class="p">,</span>
                                                     <span class="n">bands_of_interest</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;nbart_red&#39;</span><span class="p">,</span> <span class="s1">&#39;nbart_green&#39;</span><span class="p">,</span> <span class="s1">&#39;nbart_blue&#39;</span><span class="p">,</span>
                                                                        <span class="s1">&#39;nbart_nir_1&#39;</span><span class="p">,</span> <span class="s1">&#39;nbart_swir_2&#39;</span><span class="p">,</span> <span class="s1">&#39;nbart_swir_3&#39;</span><span class="p">),</span>
                                                     <span class="n">masked_prop</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Loading s2a pixel quality
    Loading 1 filtered s2a timesteps
Loading s2b pixel quality
    Skipping s2b; no valid data for query
Combining and sorting s2a data
    Replacing invalid -999 values with NaN (data will be coerced to float64)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">DEAPlotting</span><span class="o">.</span><span class="n">rgb</span><span class="p">(</span><span class="n">Clear_Canberra</span><span class="p">,</span> <span class="n">bands</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;nbart_swir_2&#39;</span><span class="p">,</span> <span class="s1">&#39;nbart_nir_1&#39;</span><span class="p">,</span> <span class="s1">&#39;nbart_green&#39;</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/notebooks_02_DEA_datasets_Introduction_to_Sentinel2_36_0.png" src="../../_images/notebooks_02_DEA_datasets_Introduction_to_Sentinel2_36_0.png" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>
</pre></div>
</div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="Introduction_to_HLTC.html" class="btn btn-neutral float-right" title="Getting started with High-Low Tide Composites (HLTC_25)" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="Introduction_to_Fractional_Cover.html" class="btn btn-neutral" title="Introduction to Fractional Cover Data" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017-2018, Geoscience Australia

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script type="text/javascript" src="https://unpkg.com/@jupyter-widgets/html-manager@^0.14.0/dist/embed-amd.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    

  

  <script type="text/javascript" src="../../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>


<!-- Theme Analytics -->
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-113800428-1"></script>
<script>
 window.dataLayer = window.dataLayer || [];
 function gtag(){dataLayer.push(arguments);}
 gtag('js', new Date());
 
 gtag('config', 'UA-113800428-1');
</script>

    
  


</body>
</html>